import{a as F,h as B,k as _,l as m,F as w,j as d,H,m as D,n as x,I as j,L,o as O,S as R,e as P,p as k,q as g,R as S,s as T,f as E,t as I,u as U,v as W,w as $,x as K}from"./index-12050af9.js";var z=function(b){F(s,b);function s(e){var t=this,n,r,a;t=b.call(this,e)||this;var i=e.store;return i.syncProps(e,void 0,["pages"]),i.updateActivePage(Object.assign({},(n=e.env)!==null&&n!==void 0?n:{},{showFullBreadcrumbPath:(r=e.showFullBreadcrumbPath)!==null&&r!==void 0?r:!1,showBreadcrumbHomePath:(a=e.showBreadcrumbHomePath)!==null&&a!==void 0?a:!0})),e.env.watchRouteChange&&(t.unWatchRouteChange=e.env.watchRouteChange(function(){var c,u,l;return i.updateActivePage(Object.assign({},(c=e.env)!==null&&c!==void 0?c:{},{showFullBreadcrumbPath:(u=e.showFullBreadcrumbPath)!==null&&u!==void 0?u:!1,showBreadcrumbHomePath:(l=e.showBreadcrumbHomePath)!==null&&l!==void 0?l:!0}))})),t}return s.prototype.componentDidMount=function(){return B(this,void 0,void 0,function(){var e,t,n,r;return _(this,function(a){switch(a.label){case 0:return e=this.props,t=e.data,n=e.dispatchEvent,[4,n("init",t,this)];case 1:return r=a.sent(),r!=null&&r.prevented?[2]:(this.reload(),[2])}})})},s.prototype.componentDidUpdate=function(e){var t,n,r;return B(this,void 0,void 0,function(){var a,i;return _(this,function(c){return a=this.props,i=a.store,i.syncProps(a,e,["pages"]),U(e.api,a.api,e.data,a.data)?this.reload():a.location&&a.location!==e.location&&i.updateActivePage(Object.assign({},(t=a.env)!==null&&t!==void 0?t:{},{showFullBreadcrumbPath:(n=a.showFullBreadcrumbPath)!==null&&n!==void 0?n:!1,showBreadcrumbHomePath:(r=a.showBreadcrumbHomePath)!==null&&r!==void 0?r:!0})),[2]})})},s.prototype.componentWillUnmount=function(){var e;(e=this.unWatchRouteChange)===null||e===void 0||e.call(this)},s.prototype.reload=function(e,t,n,r,a){return B(this,void 0,void 0,function(){var i,c,u,l,v,o,y,f,A,h;return _(this,function(p){switch(p.label){case 0:return t?[2,this.receive(t,void 0,a)]:(i=this.props,c=i.api,u=i.store,l=i.env,v=i.showFullBreadcrumbPath,o=v===void 0?!1:v,y=i.showBreadcrumbHomePath,f=y===void 0?!0:y,A=i.locale,$(c,u.data)?[4,u.fetchInitData(c,u.data,{})]:[3,2]);case 1:h=p.sent(),l.replaceText&&(h.data=K(h.data,l.replaceText,l.replaceTextIgnoreKeys)),h!=null&&h.data.pages&&(h.data=W(h.data,A),u.setPages(h.data.pages),u.updateActivePage(Object.assign({},l??{},{showFullBreadcrumbPath:o,showBreadcrumbHomePath:f}))),p.label=2;case 2:return[2,u.data]}})})},s.prototype.receive=function(e,t,n){return B(this,void 0,void 0,function(){var r;return _(this,function(a){return r=this.props.store,r.updateData(e,void 0,n),[2,this.reload()]})})},s.prototype.resolveDefinitions=function(e){var t,n=this.props,r=n.resolveDefinitions,a=n.store,i=(t=a.schema)===null||t===void 0?void 0:t.definitions;return(i==null?void 0:i[e])||r(e)},s.prototype.handleNavClick=function(e){e.preventDefault();var t=this.props.env,n=e.currentTarget.getAttribute("href");t.jumpTo(n,void 0,this.props.data)},s.prototype.renderHeader=function(){var e=this.props,t=e.classnames,n=e.brandName,r=e.header,a=e.render,i=e.store,c=e.logo,u=e.env;return!r&&!c&&!n?null:m(w,{children:[m("div",{className:t("Layout-brandBar"),children:[d("div",{onClick:i.toggleOffScreen,className:t("Layout-offScreenBtn"),children:d("i",{className:"bui-icon iconfont icon-collapse"})}),m("div",{className:t("Layout-brand"),children:[c&&~c.indexOf("<svg")?d(H,{className:t("AppLogo-html"),html:c,filterHtml:u.filterHtml}):c?d("img",{className:t("AppLogo"),src:c}):d("span",{className:"visible-folded ",children:n==null?void 0:n.substring(0,1)}),d("span",{className:"hidden-folded m-l-sm",children:n})]})]}),m("div",{className:t("Layout-headerBar"),children:[d("a",{onClick:i.toggleFolded,type:"button",className:t("AppFoldBtn"),children:d("i",{className:"fa fa-".concat(i.folded?"indent":"dedent"," fa-fw")})}),r?a("header",r):null]})]})},s.prototype.renderAside=function(){var e=this,t=this.props,n=t.store,r=t.env,a=t.asideBefore,i=t.asideAfter,c=t.render,u=t.data;return m(w,{children:[a?c("aside-before",a):null,d(D,{navigations:n.navigations,renderLink:function(l,v){var o=l.link;l.active;var y=l.toggleExpand,f=l.classnames,A=l.depth,h=l.subHeader,p=[];if(o.visible===!1)return null;!h&&o.children&&o.children.some(function(N){return N==null?void 0:N.visible})&&p.push(d("span",{className:f("AsideNav-itemArrow"),onClick:function(N){return y(o,N)}},"expand-toggle"));var C=typeof o.badge=="string"?x(o.badge,u):o.badge;return C!=null&&p.push(d("b",{className:f("AsideNav-itemBadge",o.badgeClassName||"bg-info"),children:C},"badge")),!h&&o.icon?p.push(d(j,{cx:f,icon:o.icon,className:"AsideNav-itemIcon"},"icon")):n.folded&&A===1&&!h&&p.push(d("i",{className:f("AsideNav-itemIcon",o.children?"fa fa-folder":"fa fa-info")},"icon")),p.push(d("span",{className:f("AsideNav-itemLabel"),children:typeof o.label=="string"?x(o.label,u):o.label},"label")),o.path?/^https?\:/.test(o.path)?d("a",{target:"_blank",href:o.path,rel:"noopener",children:p},"link"):d("a",{onClick:e.handleNavClick,href:o.path||o.children&&o.children[0].path,children:p},"link"):d("a",{onClick:o.children?function(){return y(o)}:void 0,children:p},"link")},isActive:function(l){return!!r.isCurrentUrl(l==null?void 0:l.path,l)}}),i?c("aside-before",i):null]})},s.prototype.renderFooter=function(){var e=this.props,t=e.render,n=e.footer;return n?t("footer",n):null},s.prototype.render=function(){var e=this,t,n=this.props,r=n.classnames,a=n.store,i=n.render,c=n.showBreadcrumb,u=c===void 0?!0:c,l=n.loadingConfig;return m(L,{header:this.renderHeader(),aside:this.renderAside(),footer:this.renderFooter(),folded:a.folded,offScreen:a.offScreen,contentClassName:r("AppContent"),children:[a.activePage&&a.schema?m(w,{children:[u&&a.bcn.length?d("ul",{className:r("AppBcn"),children:a.bcn.map(function(v,o){return d("li",{className:r("AppBcn-item"),children:v.path?d("a",{href:v.path,onClick:e.handleNavClick,children:v.label}):o!==a.bcn.length-1?d("a",{children:v.label}):v.label},o)})}):null,d("div",{className:r("AppBody"),children:i("page",a.schema,{key:"".concat((t=a.activePage)===null||t===void 0?void 0:t.id,"-").concat(a.schemaKey),data:a.pageData,resolveDefinitions:this.resolveDefinitions})})]}):a.pages&&!a.activePage?d(O,{children:d("div",{className:"text-center",children:"页面不存在"})}):null,d(R,{loadingConfig:l,overlay:!0,show:a.loading||!a.pages,size:"lg"})]})},s.propsList=["brandName","logo","header","asideBefore","asideAfter","pages","footer"],s.defaultProps={},P([k,g("design:type",Function),g("design:paramtypes",[String]),g("design:returntype",void 0)],s.prototype,"resolveDefinitions",null),P([k,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",void 0)],s.prototype,"handleNavClick",null),s}(S.Component),q=function(b){F(s,b);function s(e,t){var n=b.call(this,e)||this,r=t;return r.registerComponent(n),n}return s.prototype.componentWillUnmount=function(){var e=this.context;e.unRegisterComponent(this),b.prototype.componentWillUnmount.call(this)},s.prototype.setData=function(e,t){return this.props.store.updateData(e,void 0,t)},s.prototype.getData=function(){var e=this.props.store;return e.data},s.contextType=T,s=P([E({type:"app",storeType:I.name}),g("design:paramtypes",[Object,Object])],s),s}(z);export{z as App,q as default};

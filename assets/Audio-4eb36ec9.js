import{a as R,Z as N,dy as P,j as r,l as h,I as d,aA as S,F,e as s,p as u,q as n,R as H,f as V,n as k}from"./index-12050af9.js";var A=function(p){R(a,p);function a(){var t=p!==null&&p.apply(this,arguments)||this;return t.state={src:N(t.props,function(e){return e.src?k(e.src,e.data,"| raw"):void 0})||"",isReady:!1,muted:!1,playing:!1,played:0,seeking:!1,volume:.8,prevVolume:.8,loaded:0,playbackRate:1,showHandlePlaybackRate:!1,showHandleVolume:!1},t}return a.prototype.componentWillUnmount=function(){clearTimeout(this.progressTimeout),clearTimeout(this.durationTimeout)},a.prototype.componentDidMount=function(){var t=this.props.autoPlay,e=!!t;this.setState({playing:e},this.progress)},a.prototype.componentDidUpdate=function(t){var e=this,i=this.props;P(i,t,function(o){return e.setState({src:o,playing:!1},function(){e.audio.load(),e.progress()})},function(o){return o.src?k(o.src,o.data,"| raw"):void 0})},a.prototype.progress=function(){if(clearTimeout(this.progressTimeout),this.state.src&&this.audio){var t=this.audio.currentTime||0,e=this.audio.duration,i=t/e,o=this.state.playing;o=!!(i!=1&&o),this.setState({played:i,playing:o}),this.progressTimeout=setTimeout(this.progress,this.props.progressInterval/this.state.playbackRate)}},a.prototype.audioRef=function(t){this.audio=t},a.prototype.load=function(){this.setState({isReady:!0})},a.prototype.handlePlaybackRate=function(t){this.audio.playbackRate=t,this.setState({playbackRate:t,showHandlePlaybackRate:!1})},a.prototype.handleMute=function(){if(this.state.src){var t=this.state,e=t.muted,i=t.prevVolume,o=e?i:0;this.audio.muted=!e,this.setState({muted:!e,volume:o})}},a.prototype.handlePlaying=function(){if(this.state.src){var t=this.state.playing;t?this.audio.pause():this.audio.play(),this.setState({playing:!t})}},a.prototype.getCurrentTime=function(){if(!this.audio||!this.state.src||!this.state.isReady)return"0:00";var t=this.audio.duration,e=this.state.played;return this.formatTime(t*(e||0))},a.prototype.getDuration=function(){if(!this.audio||!this.state.src)return"0:00";if(!this.state.isReady)return this.onDurationCheck(),"0:00";var t=this.audio,e=t.duration,i=t.seekable;return e===1/0&&i.length>0?i.end(i.length-1):this.formatTime(e)},a.prototype.onDurationCheck=function(){clearTimeout(this.durationTimeout);var t=this.audio&&this.audio.duration;t||(this.durationTimeout=setTimeout(this.onDurationCheck,500))},a.prototype.onSeekChange=function(t){if(this.state.src){var e=t.target.value;this.setState({played:e})}},a.prototype.onSeekMouseDown=function(){this.setState({seeking:!0})},a.prototype.onSeekMouseUp=function(t){if(this.state.src&&this.state.seeking){var e=t.target.value,i=this.audio.duration;this.audio.currentTime=i*e;var o=this.props.loop,l=this.state.playing;l=e<1||o?l:!1,this.setState({playing:l,seeking:!1})}},a.prototype.setVolume=function(t){if(this.state.src){var e=t.target.value;this.audio.volume=e,this.setState({volume:e,prevVolume:e})}},a.prototype.formatTime=function(t){var e=new Date(t*1e3),i=e.getUTCHours(),o=isNaN(e.getUTCMinutes())?0:e.getUTCMinutes(),l=isNaN(e.getUTCSeconds())?"00":this.pad(e.getUTCSeconds());return i?"".concat(i,":").concat(this.pad(o),":").concat(l):"".concat(o,":").concat(l)},a.prototype.pad=function(t){return("0"+t).slice(-2)},a.prototype.toggleHandlePlaybackRate=function(){this.state.src&&this.setState({showHandlePlaybackRate:!this.state.showHandlePlaybackRate})},a.prototype.toggleHandleVolume=function(t){this.state.src&&this.setState({showHandleVolume:t})},a.prototype.renderRates=function(){var t=this,e=this.props,i=e.rates,o=e.classnames,l=this.state,m=l.showHandlePlaybackRate,g=l.playbackRate;return i&&i.length?m?r("div",{className:o("Audio-rateControl"),children:i.map(function(c,y){return h("div",{className:o("Audio-rateControlItem"),onClick:function(){return t.handlePlaybackRate(c)},children:["x",c.toFixed(1)]},y)})}):h("div",{className:o("Audio-rates"),onClick:this.toggleHandlePlaybackRate,children:["x",g.toFixed(1)]}):null},a.prototype.renderPlay=function(){var t=this.props.classnames,e=this.state.playing;return r("div",{className:t("Audio-play"),onClick:this.handlePlaying,children:e?r(d,{icon:"pause",className:"icon"}):r(d,{icon:"play",className:"icon"})})},a.prototype.renderTime=function(){var t=this.props.classnames;return h("div",{className:t("Audio-times"),children:[this.getCurrentTime()," / ",this.getDuration()]})},a.prototype.renderProcess=function(){var t=this.props.classnames,e=this.state.played;return r("div",{className:t("Audio-process"),children:r("input",{type:"range",min:0,max:1,step:"any",value:e||0,onMouseDown:this.onSeekMouseDown,onChange:this.onSeekChange,onMouseUp:this.onSeekMouseUp})})},a.prototype.renderVolume=function(){var t=this,e=this.props.classnames,i=this.state,o=i.volume,l=i.showHandleVolume;return l?h("div",{className:e("Audio-volumeControl"),onMouseLeave:function(){return t.toggleHandleVolume(!1)},children:[r("div",{className:e("Audio-volumeControlIcon"),onClick:this.handleMute,children:o>0?r(d,{icon:"volume",className:"icon"}):r(d,{icon:"mute",className:"icon"})}),r("input",{type:"range",min:0,max:1,step:"any",value:o,onChange:this.setVolume})]}):r("div",{className:e("Audio-volume"),onMouseEnter:function(){return t.toggleHandleVolume(!0)},children:o>0?r(d,{icon:"volume",className:"icon"}):r(d,{icon:"mute",className:"icon"})})},a.prototype.render=function(){var t=this,e=this.props,i=e.className,o=e.style,l=e.inline,m=e.autoPlay,g=e.loop,c=e.controls,y=e.classnames,f=this.state,b=f.muted,C=f.src;return h("div",{className:y("Audio",i,l?"Audio--inline":""),style:o,children:[r("audio",{className:y("Audio-original"),ref:this.audioRef,onCanPlay:this.load,autoPlay:m,controls:!0,muted:b,loop:g,children:r("source",{src:C})}),r("div",{className:y("Audio-controls"),children:c&&c.map(function(v,M){v="render"+S(v);var T=v;return r(F,{children:t[T]()})})})]})},a.defaultProps={inline:!0,autoPlay:!1,playbackRate:1,loop:!1,rates:[],progressInterval:1e3,controls:["rates","play","time","process","volume"]},s([u,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],a.prototype,"progress",null),s([u,n("design:type",Function),n("design:paramtypes",[HTMLMediaElement]),n("design:returntype",void 0)],a.prototype,"audioRef",null),s([u,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],a.prototype,"load",null),s([u,n("design:type",Function),n("design:paramtypes",[Number]),n("design:returntype",void 0)],a.prototype,"handlePlaybackRate",null),s([u,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],a.prototype,"handleMute",null),s([u,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],a.prototype,"handlePlaying",null),s([u,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],a.prototype,"getCurrentTime",null),s([u,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],a.prototype,"getDuration",null),s([u,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],a.prototype,"onDurationCheck",null),s([u,n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",void 0)],a.prototype,"onSeekChange",null),s([u,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],a.prototype,"onSeekMouseDown",null),s([u,n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",void 0)],a.prototype,"onSeekMouseUp",null),s([u,n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",void 0)],a.prototype,"setVolume",null),s([u,n("design:type",Function),n("design:paramtypes",[Number]),n("design:returntype",void 0)],a.prototype,"formatTime",null),s([u,n("design:type",Function),n("design:paramtypes",[Number]),n("design:returntype",void 0)],a.prototype,"pad",null),s([u,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],a.prototype,"toggleHandlePlaybackRate",null),s([u,n("design:type",Function),n("design:paramtypes",[Boolean]),n("design:returntype",void 0)],a.prototype,"toggleHandleVolume",null),a}(H.Component),x=function(p){R(a,p);function a(){return p!==null&&p.apply(this,arguments)||this}return a=s([V({type:"audio"})],a),a}(A);export{A as Audio,x as AudioRenderer};

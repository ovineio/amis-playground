import{a as B,aq as T,w as q,d as C,h as P,k as O,as as z,aj as H,al as L,j,b as X,l as Y,X as I,ao as U,U as V,S as $,V as G,e as D,a_ as J,q as E,R as K,b9 as Q,aC as W,Y as R}from"./index-26b02238.js";var Z=function(S){B(u,S);function u(a){var e=S.call(this,a)||this;return e.state={stack:[]},e.handleChange=e.handleChange.bind(e),e.loadMore=e.loadMore.bind(e),e}return u.prototype.componentDidMount=function(){var a,e,i=this.props.formInited;i||!this.props.addHook?this.loadMore():(e=(a=this.props).addHook)===null||e===void 0||e.call(a,this.loadMore,"init")},u.prototype.componentDidUpdate=function(a){var e=this.props;a.options!==e.options?this.setState({stack:[]}):e.formInited&&e.value!==a.value&&this.loadMore()},u.prototype.doAction=function(a,e,i){var o,h,c=this.props,f=c.resetValue,d=c.onChange,p=c.formStore,l=c.store,r=c.name,v=a==null?void 0:a.actionType;if(v==="clear")d("");else if(v==="reset"){var n=(h=T((o=p==null?void 0:p.pristine)!==null&&o!==void 0?o:l==null?void 0:l.pristine,r))!==null&&h!==void 0?h:f;d(n??"")}},u.prototype.array2value=function(a,e){e===void 0&&(e=!1);var i=this.props,o=i.delimiter,h=i.joinValues,c=i.extractValue,f=i.valueField;return e?h?a.join(o||","):a:h?a.join(o||","):c?a.map(function(d){return d[f||"value"]||d}):a},u.prototype.loadMore=function(){for(var a=this,e=this.props,i=e.value,o=e.delimiter,h=e.onChange,c=e.joinValues,f=e.extractValue,d=e.valueField,p=e.source,l=e.data,r=e.env,v=e.dispatchEvent,n=Array.isArray(i)?i.concat():i&&typeof i=="string"?i.split(o||","):[],t=0,N=this.state.stack.length;t<N&&n[t]&&this.state.stack[t].parentId==(c||f?n[t]:n[t][d||"value"]);)t++;if(!(!n[t]||!r||!q(p,l))){var b=c||f?n[t]:n[t][d||"value"],m=this.state.stack.concat();m.splice(t,m.length-t),m.push({parentId:b,loading:!0,options:[]}),this.setState({stack:m},function(){r.fetcher(p,C(C({},l),{value:n,level:t+1,parentId:b,parent:n[t]})).then(function(s){return P(a,void 0,void 0,function(){var _,g,y,k,A,x,M,F;return O(this,function(w){switch(w.label){case 0:return _=this.state.stack.concat(),g=s.data?s.data[d||"value"]:void 0,y=((x=s==null?void 0:s.data)===null||x===void 0?void 0:x.options)||((M=s==null?void 0:s.data)===null||M===void 0?void 0:M.items)||((F=s==null?void 0:s.data)===null||F===void 0?void 0:F.rows)||s.data||[],_.splice(t,_.length-t),typeof g<"u"?(n.splice(t+1,i.length-t-1),n.push(g),k=this.array2value(n,!0),[4,v("change",R(this.props,{value:k}))]):[3,2];case 1:if(A=w.sent(),A!=null&&A.prevented)return[2];h(k),w.label=2;case 2:return _.push({options:y,parentId:b,loading:!1,visible:Array.isArray(y)&&!W(y)}),this.setState({stack:_},this.loadMore),[2]}})})}).catch(function(s){!(p!=null&&p.silent)&&r.notify("error",s.message)})})}},u.prototype.handleChange=function(a,e){return P(this,void 0,void 0,function(){var i,o,h,c,f,d,p,l,r,v,n;return O(this,function(t){switch(t.label){case 0:return i=this.props,o=i.value,h=i.delimiter,c=i.onChange,f=i.joinValues,i.extractValue,d=i.dispatchEvent,p=i.valueField,i.data,l=Array.isArray(o)?o.concat():o&&typeof o=="string"?o.split(h||","):[],l.splice(a,l.length-a),r=f?e[p||"value"]:e,r!==void 0&&l.push(r),v=this.array2value(l),[4,d("change",R(this.props,{value:v}))];case 1:return n=t.sent(),n!=null&&n.prevented?[2]:(c(v),[2])}})})},u.prototype.reload=function(){var a=this.props.reloadOptions;a&&a()},u.prototype.renderStatic=function(a){a===void 0&&(a="-");var e=this.props,i=e.options,o=i===void 0?[]:i,h=e.labelField,c=e.valueField,f=e.classPrefix,d=e.classnames,p=e.className,l=e.value,r=e.delimiter,v=z([{options:o,visible:!0}],H(this.state.stack||[]),!1),n=Array.isArray(l)?l.concat():l&&typeof l=="string"?l.split(r||","):[];return(n==null?void 0:n.length)>0&&(a=n.map(function(t,N){var b,m=v[N]||{},s=m.options,_=m.visible;if(_===!1)return null;if(!s||!s.length)return t;var g=L(s,function(y){return t===y[c||"value"]})||{};return(b=g[h||"label"])!==null&&b!==void 0?b:t}).filter(function(t){return t!=null}).join(" > ")),j("div",{className:d("".concat(f,"SelectStaticControl"),p),children:a})},u.prototype.render=function(){var a=this,e=this.props,i=e.options,o=e.classPrefix,h=e.className,c=e.style;e.inline;var f=e.loading,d=e.value,p=e.delimiter;e.joinValues,e.extractValue,e.multiple;var l=e.mobileUI,r=e.env,v=e.testIdBuilder,n=e.popoverClassName,t=X(e,["options","classPrefix","className","style","inline","loading","value","delimiter","joinValues","extractValue","multiple","mobileUI","env","testIdBuilder","popoverClassName"]),N=Array.isArray(d)?d.concat():d&&typeof d=="string"?d.split(p||","):[],b=this.props,m=b.themeCss,s=b.id,_=this.state.stack.find(function(g){return g.loading});return Y("div",{className:I("".concat(o,"ChainedSelectControl"),h),children:[j(U,{...C({},t,{mobileUI:l,popOverContainer:l?r==null?void 0:r.getModalContainer:t.popOverContainer||(r==null?void 0:r.getModalContainer),className:I(V(C(C({},this.props),{name:"chainedSelectControlClassName",id:s,themeCss:m}))),popoverClassName:I(n,V(C(C({},this.props),{name:"chainedSelectPopoverClassName",id:s,themeCss:m}))),controlStyle:c,classPrefix:o,key:"base",testIdBuilder:v==null?void 0:v.getChild("base"),options:Array.isArray(i)?i:[],value:N[0],onChange:this.handleChange.bind(this,0),loading:f,inline:!0})}),this.state.stack.map(function(g,y){var k=g.options,A=g.loading,x=g.visible;return x===!1||A?null:j(U,{...C({},t,{mobileUI:l,popOverContainer:l?r.getModalContainer:t.popOverContainer||(r==null?void 0:r.getModalContainer),classPrefix:o,key:"x-".concat(y+1),testIdBuilder:v==null?void 0:v.getChild("x-".concat(y+1)),options:Array.isArray(k)?k:[],value:N[y+1],onChange:a.handleChange.bind(a,y+1),inline:!0,controlStyle:c,className:I(V(C(C({},a.props),{name:"chainedSelectControlClassName",id:s,themeCss:m}))),popoverClassName:I(n,V(C(C({},a.props),{name:"chainedSelectPopoverClassName",id:s,themeCss:m})))})})}),_&&j($,{size:"sm",className:I("".concat(o,"ChainedSelectControl-spinner"))}),j(G,{...C({},this.props,{config:{themeCss:m,classNames:[{key:"chainedSelectControlClassName",weights:{focused:{suf:".is-opened:not(.is-mobile)"},disabled:{suf:".is-disabled"}}},{key:"chainedSelectPopoverClassName",weights:{default:{suf:" .".concat(o,"Select-option")},hover:{suf:" .".concat(o,"Select-option.is-highlight")},focused:{inner:".".concat(o,"Select-option.is-active")}}}],id:s},env:r})})]})},u.defaultProps={clearable:!1,searchable:!1,multiple:!0},D([J(),E("design:type",Function),E("design:paramtypes",[]),E("design:returntype",void 0)],u.prototype,"render",null),u}(K.Component),ae=function(S){B(u,S);function u(){return S!==null&&S.apply(this,arguments)||this}return u=D([Q({type:"chained-select",sizeMutable:!1})],u),u}(Z);export{ae as ChainedSelectControlRenderer,Z as default};

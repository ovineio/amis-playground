import{a as __extends,b2 as debounce,h as __awaiter,k as __generator,u as isApiOutdated,i as isPureVariable,r as resolveVariableAndFilter,n as filter,E as createObject,d as __assign,ai as pick,_ as __vitePreload,aj as __read,c6 as dataMapping,au as isAlive,aL as buildStyle,l as jsxs,X as cx,U as setThemeClassName,j as jsx,dm as themedLazyComponent,V as CustomStyle,R as React__default,s as ScopedContext,e as __decorate,f as Renderer,cW as ServiceStore,q as __metadata,dn as findObjectsWithKey,bm as __values,a7 as str2function,bT as resizeSensor,dp as loadScript,d8 as normalizeApiResponseData,aP as isString,w as isEffectiveApi}from"./index-12050af9.js";var DEFAULT_EVENT_PARAMS=["componentType","seriesType","seriesIndex","seriesName","name","dataIndex","data","dataType","value","color"],EVAL_CACHE={};function recoverFunctionType(config){["interval","formatter","color","min","max","labelFormatter","valueFormatter","pageFormatter","optionToContent","contentToOption","animationDelay","animationDurationUpdate","animationDelayUpdate","animationDuration","position","sort","renderItem"].forEach(function(key){var e_1,_a,objects=findObjectsWithKey(config,key);try{for(var objects_1=__values(objects),objects_1_1=objects_1.next();!objects_1_1.done;objects_1_1=objects_1.next()){var object=objects_1_1.value,code=object[key];if(typeof code=="string"&&code.trim().startsWith("function"))try{code in EVAL_CACHE||(EVAL_CACHE[code]=eval("("+code+")")),object[key]=EVAL_CACHE[code]}catch(m){console.warn(code,m)}}}catch(m){e_1={error:m}}finally{try{objects_1_1&&!objects_1_1.done&&(_a=objects_1.return)&&_a.call(objects_1)}finally{if(e_1)throw e_1.error}}})}var Chart=function(m){__extends(o,m);function o(t){var e=m.call(this,t)||this;return e.refFn=e.refFn.bind(e),e.reload=e.reload.bind(e),e.reloadEcharts=debounce(e.reloadEcharts.bind(e),300),e.handleClick=e.handleClick.bind(e),e.dispatchEvent=e.dispatchEvent.bind(e),e.loadChartMapData=e.loadChartMapData.bind(e),e.mounted=!0,t.config&&e.renderChart(t.config),e}return o.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,function(){var t,e,a,r,s,i,n,d;return __generator(this,function(h){switch(h.label){case 0:return t=this.props,e=t.api,a=t.data,r=t.initFetch,s=t.source,i=t.dispatchEvent,[4,i("init",a,this)];case 1:return n=h.sent(),n!=null&&n.prevented?[2]:(s&&isPureVariable(s)?(d=resolveVariableAndFilter(s,a,"| raw"),d&&this.renderChart(d)):e&&r!==!1&&this.reload(),[2])}})})},o.prototype.componentDidUpdate=function(t){var e=this,a=this.props;if(isApiOutdated(t.api,a.api,t.data,a.data))this.reload();else if(a.source&&isPureVariable(a.source)){var r=t.source?resolveVariableAndFilter(t.source,t.data,"| raw"):null,s=resolveVariableAndFilter(a.source,a.data,"| raw");r!==s&&this.renderChart(s||{})}else if(a.config!==t.config)this.renderChart(a.config||{});else if(a.config&&a.trackExpression&&filter(a.trackExpression,a.data)!==filter(t.trackExpression,t.data))this.renderChart(a.config||{});else if(isApiOutdated(t.mapURL,a.mapURL,t.data,a.data)){var i=a.source,n=a.data,d=a.api,h=a.config;this.loadChartMapData(function(){if(i&&isPureVariable(i)){var v=resolveVariableAndFilter(i,n,"| raw");v&&e.renderChart(v)}else d?e.reload():h&&e.renderChart(h||{})})}},o.prototype.componentWillUnmount=function(){this.mounted=!1,this.reloadEcharts.cancel(),clearTimeout(this.timer)},o.prototype.loadChartMapData=function(t){return __awaiter(this,void 0,void 0,function(){var e,a,r,s,i,n,d;return __generator(this,function(h){switch(h.label){case 0:return e=this.props,a=e.env,r=e.data,s=this.props,i=s.mapName,n=s.mapURL,n&&i&&window.echarts?(isPureVariable(i)&&(i=resolveVariableAndFilter(i,r)),[4,a.fetcher(n,r)]):[3,2];case 1:d=h.sent(),d.ok||console.warn("fetch map geo error "+n),window.echarts.registerMap(i,d.data),h.label=2;case 2:return t&&t(),[2]}})})},o.prototype.handleClick=function(t){return __awaiter(this,void 0,void 0,function(){var e,a,r,s,i,n;return __generator(this,function(d){switch(d.label){case 0:return e=this.props,a=e.onAction,r=e.clickAction,s=e.data,i=e.dispatchEvent,[4,i(t.event,createObject(s,__assign({},pick(t,DEFAULT_EVENT_PARAMS))))];case 1:return n=d.sent(),n!=null&&n.prevented?[2]:(r&&a&&a(null,r,createObject(s,t)),[2])}})})},o.prototype.dispatchEvent=function(t){var e=this.props,a=e.data,r=e.dispatchEvent;r(t.event||t.type,createObject(a,__assign({},pick(t,t.type==="legendselectchanged"?["name","selected"]:DEFAULT_EVENT_PARAMS))))},o.prototype.refFn=function(t){var e=this,a=this.props.chartRef,r=this.props,s=r.chartTheme,i=r.onChartWillMount,n=r.onChartUnMount,d=r.env,h=r.loadBaiduMap;r.data;var v=this.props,b=v.mapURL,C=v.mapName,c=this.props.onChartMount||this.onChartMount;t?Promise.all([__vitePreload(()=>import("./index-43d71436.js").then(l=>l.i),[]),__vitePreload(()=>import("./index-e9aa1ada.js").then(l=>l.i),["assets/index-e9aa1ada.js","assets/index-12050af9.js","assets/index-3250bc9b.css"]),__vitePreload(()=>import("./index-4c40f276.js"),["assets/index-4c40f276.js","assets/index-43d71436.js"]),__vitePreload(()=>import("./bmap-13da8e61.js"),["assets/bmap-13da8e61.js","assets/index-43d71436.js"]),__vitePreload(()=>import("./echarts-wordcloud-8d004ff4.js").then(l=>l.e),["assets/echarts-wordcloud-8d004ff4.js","assets/index-12050af9.js","assets/index-3250bc9b.css"])]).then(function(l){var _=__read(l,2),f=_[0],u=_[1];return __awaiter(e,void 0,void 0,function(){var g,w=this;return __generator(this,function(p){switch(p.label){case 0:return window.echarts=f,window.ecStat=(u==null?void 0:u.default)||u,b&&C?[4,this.loadChartMapData()]:[3,2];case 1:p.sent(),p.label=2;case 2:return h?[4,loadScript("//api.map.baidu.com/api?v=3.0&ak=".concat(this.props.ak,"&callback={{callback}}"))]:[3,4];case 3:p.sent(),p.label=4;case 4:return g="default",s&&(f.registerTheme("custom",s),g="custom"),i?[4,i(f)]:[3,6];case 5:p.sent(),p.label=6;case 6:return u.transform&&(f.registerTransform(u.transform.regression),f.registerTransform(u.transform.histogram),f.registerTransform(u.transform.clustering)),d.loadChartExtends?[4,d.loadChartExtends()]:[3,8];case 7:p.sent(),p.label=8;case 8:return this.echarts=f.init(t,g),typeof c=="string"&&(c=str2function(c,"chart","echarts")),c==null||c(this.echarts,f),this.echarts.on("click",this.handleClick),this.echarts.on("mouseover",this.dispatchEvent),this.echarts.on("legendselectchanged",this.dispatchEvent),this.unSensor=resizeSensor(t,function(){var y,A=t.offsetWidth,E=t.offsetHeight;(y=w.echarts)===null||y===void 0||y.resize({width:A,height:E})}),a&&a(this.echarts),this.renderChart(),[2]}})})}):(a&&a(null),this.unSensor&&this.unSensor(),this.echarts&&(n==null||n(this.echarts,window.echarts),this.echarts.dispose(),delete this.echarts)),this.ref=t},o.prototype.doAction=function(t,e,a){var r,s;return(s=(r=this.echarts)===null||r===void 0?void 0:r.dispatchAction)===null||s===void 0?void 0:s.call(r,__assign({type:t.actionType},e))},o.prototype.reload=function(t,e,a,r,s){var i,n,d,h,v,b;return __awaiter(this,void 0,void 0,function(){var C,c,l,_,f,u,g,w,p,y,A=this;return __generator(this,function(E){switch(E.label){case 0:if(C=this.props,c=C.api,l=C.env,_=C.store,f=C.translate,e)return[2,this.receive(e,void 0,s)];if(!l||!l.fetcher||!isEffectiveApi(c,_.data))return[2];clearTimeout(this.timer),this.reloadCancel&&(this.reloadCancel(),delete this.reloadCancel,(i=this.echarts)===null||i===void 0||i.hideLoading()),(n=this.echarts)===null||n===void 0||n.showLoading(),_.markFetching(!0),E.label=1;case 1:return E.trys.push([1,3,,4]),[4,l.fetcher(c,_.data,{cancelExecutor:function(T){return A.reloadCancel=T}})];case 2:return u=E.sent(),isAlive(_)&&_.markFetching(!1),u.ok?(delete this.reloadCancel,g=normalizeApiResponseData(u.data),!g.series&&this.props.config?(w=createObject(this.props.data,g),this.renderChart(this.props.config,w)):this.renderChart(u.data||{}),(v=this.echarts)===null||v===void 0||v.hideLoading(),p=this.props.interval,p&&isString(p)&&(p=Number.parseInt(p)),p&&this.mounted&&(this.timer=setTimeout(this.reload,Math.max(p,1e3))),[2,_.data]):(!(c!=null&&c.silent)&&l.notify("error",(h=(d=c==null?void 0:c.messages)===null||d===void 0?void 0:d.failed)!==null&&h!==void 0?h:u.msg||f("fetchFailed"),u.msgTimeout!==void 0?{closeButton:!0,timeout:u.msgTimeout}:void 0),[2]);case 3:return y=E.sent(),l.isCancel(y)?[2]:(isAlive(_)&&_.markFetching(!1),!(c!=null&&c.silent)&&l.notify("error",y),(b=this.echarts)===null||b===void 0||b.hideLoading(),[3,4]);case 4:return[2]}})})},o.prototype.receive=function(t,e,a){var r=this.props.store;r.updateData(t,void 0,a),this.reload()},o.prototype.renderChart=function(t,e){var a,r;if(t&&(this.pending=t),e&&(this.pendingCtx=e),!!this.echarts){var s=this.props.store,i=this.props.onDataFilter,n=this.props.dataFilter;!i&&typeof n=="string"&&(i=new Function("config","echarts","data",n)),t=t||this.pending,e=e||this.pendingCtx||this.props.data,typeof t=="string"&&(t=new Function("return "+t)());try{i&&(t=i(t,window.echarts,e)||t)}catch(d){console.warn(d)}if(t)try{this.props.disableDataMapping||(t=dataMapping(t,e,function(d,h){return typeof h=="function"||typeof h=="string"&&h.startsWith("function")})),recoverFunctionType(t),isAlive(s)&&s.loading?(a=this.echarts)===null||a===void 0||a.showLoading():(r=this.echarts)===null||r===void 0||r.hideLoading(),this.reloadEcharts(t)}catch(d){console.warn(d)}}},o.prototype.reloadEcharts=function(t){var e;(e=this.echarts)===null||e===void 0||e.setOption(t,this.props.replaceChartOption)},o.prototype.render=function(){var t=this,e=this.props,a=e.className,r=e.width,s=e.height,i=e.classPrefix,n=e.unMountOnHidden,d=e.data,h=e.id,v=e.wrapperCustomStyle,b=e.env,C=e.themeCss;e.baseControlClassName;var c=this.props.style||{};c.width=c.width||r||"100%",c.height=c.height||s||"300px";var l=buildStyle(c,d);return jsxs("div",{className:cx("".concat(i,"Chart"),a,setThemeClassName(__assign(__assign({},this.props),{name:"baseControlClassName",id:h,themeCss:C})),setThemeClassName(__assign(__assign({},this.props),{name:"wrapperCustomStyle",id:h,themeCss:v}))),style:l,children:[jsx(themedLazyComponent,{unMountOnHidden:n,placeholder:"...",component:function(){return jsx("div",{className:"".concat(i,"Chart-content"),ref:t.refFn})}}),jsx(CustomStyle,{...__assign({},this.props,{config:{wrapperCustomStyle:v,id:h,themeCss:C,classNames:[{key:"baseControlClassName"}]},env:b})})]})},o.defaultProps={replaceChartOption:!1,unMountOnHidden:!1},o.propsList=[],o}(React__default.Component),ChartRenderer=function(m){__extends(o,m);function o(t,e){var a=m.call(this,t)||this,r=e;return r.registerComponent(a),a}return o.prototype.componentWillUnmount=function(){m.prototype.componentWillUnmount.call(this);var t=this.context;t.unRegisterComponent(this)},o.prototype.setData=function(t,e){var a=this.props.store;a.updateData(t,void 0,e),this.renderChart(this.props.config,a.data)},o.prototype.getData=function(){var t=this.props.store;return t.data},o.contextType=ScopedContext,o=__decorate([Renderer({type:"chart",storeType:ServiceStore.name}),__metadata("design:paramtypes",[Object,Object])],o),o}(Chart);export{Chart,ChartRenderer};

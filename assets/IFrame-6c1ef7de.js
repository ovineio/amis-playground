import{a as x,h as L,j,r as N,C as S,t as A,e as h,N as M,Q as U,f as g,o as b,p as n,q as B,R as W,dA as z,dB as D,ag as J}from"./index-d5f8b387.js";const m=window.React;var P=function(p){x(a,p);function a(){var e=p!==null&&p.apply(this,arguments)||this;return e.IFrameRef=m.createRef(),e.state={width:e.props.width||"100%",height:e.props.height||"100%"},e}return a.prototype.componentDidMount=function(){window.addEventListener("message",this.onMessage)},a.prototype.componentDidUpdate=function(e){var r=this.props.data;r!==e.data?this.postMessage("update",r):(this.props.width!==e.width||this.props.height!==e.height)&&this.setState({width:this.props.width||"100%",height:this.props.height||"100%"})},a.prototype.componentWillUnmount=function(){window.removeEventListener("message",this.onMessage)},a.prototype.validateURL=function(e){return e&&typeof e=="string"&&/^data:([a-zA-Z0-9]+\/[a-zA-Z0-9]+);base64,.*/.test(e)?!0:!(e&&typeof e=="string"&&!/^(\.\/|\.\.\/|\/|(blob\:)?https?\:\/\/|\/\/)/.test(e))},a.prototype.onMessage=function(e){var r,s,t;return L(this,void 0,void 0,function(){var i,u,v,C,w,d,_,o,f,y,c;return j(this,function(l){switch(l.label){case 0:return i=this.props,u=i.events,v=i.onEvent,C=i.onAction,w=i.data,typeof((r=e==null?void 0:e.data)===null||r===void 0?void 0:r.type)!="string"?[2]:(d=J(e.data.type.split(":"),2),_=d[0],o=d[1],_!=="amis"||!o?[2]:o==="resize"&&e.data.data?(this.setState({width:e.data.data.width||"100%",height:e.data.data.height||"100%"}),[3,4]):[3,1]);case 1:return f=v==null?void 0:v[o],f&&(!((s=f.actions)===null||s===void 0)&&s.length)?(y=z(o,{env:(t=this.props)===null||t===void 0?void 0:t.env,nativeEvent:e,data:S(w,e.data.data),scoped:this.context}),[4,D(f.actions,this,y)]):[3,3];case 2:if(l.sent(),y.prevented)return[2];l.label=3;case 3:u&&(c=u[o],c&&C(e,c,S(w,e.data.data))),l.label=4;case 4:return[2]}})})},a.prototype.onLoad=function(){var e=this.props,r=e.src,s=e.data;r&&this.postMessage("init",s)},a.prototype.reload=function(e,r){if(r)return this.receive(r);var s=this.props,t=s.src,i=s.data;t&&(this.IFrameRef.current.src=N(t,i,"| raw"))},a.prototype.receive=function(e){var r=this.props,s=r.src,t=r.data,i=S(t,e);this.postMessage("receive",i),A(s,s,t,i)&&(this.IFrameRef.current.src=N(s,i,"| raw"))},a.prototype.postMessage=function(e,r){var s,t;(t=(s=this.IFrameRef.current)===null||s===void 0?void 0:s.contentWindow)===null||t===void 0||t.postMessage({type:"amis:".concat(e),data:JSON.parse(JSON.stringify(r))},"*")},a.prototype.render=function(){var e=this.state,r=e.width,s=e.height,t=this.props,i=t.className,u=t.src,v=t.name,C=t.frameBorder,w=t.data,d=t.style,_=t.allow,o=t.sandbox,f=t.referrerpolicy,y=t.translate,c=t.id,l=t.wrapperCustomStyle,E=t.env,I=t.themeCss;t.baseControlClassName;var O=t.classnames,R={};r!==void 0&&(R.width=r),s!==void 0&&(R.height=s),d=h(h({},R),d);var F=u?N(u,w,"| raw"):void 0;return this.validateURL(F)?(location.protocol==="https:"&&F&&F.startsWith("http://")&&E.notify("error",y("Iframe.invalidProtocol")),m.createElement(m.Fragment,null,m.createElement("iframe",{name:v,className:O("IFrame",i,M(h(h({},this.props),{name:"baseControlClassName",id:c,themeCss:I})),M(h(h({},this.props),{name:"wrapperCustomStyle",id:c,themeCss:l}))),frameBorder:C,style:d,ref:this.IFrameRef,onLoad:this.onLoad,src:F,allow:_,referrerPolicy:f,sandbox:o}),m.createElement(U,h({},this.props,{config:{wrapperCustomStyle:l,id:c,themeCss:I,classNames:[{key:"baseControlClassName"}]},env:E})))):m.createElement("p",null,y("Iframe.invalid"))},a.propsList=["src","className"],a.defaultProps={className:"",frameBorder:0},g([b,n("design:type",Function),n("design:paramtypes",[MessageEvent]),n("design:returntype",Promise)],a.prototype,"onMessage",null),g([b,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],a.prototype,"onLoad",null),g([b,n("design:type",Function),n("design:paramtypes",[Object,Object]),n("design:returntype",void 0)],a.prototype,"reload",null),g([b,n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",void 0)],a.prototype,"receive",null),g([b,n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",void 0)],a.prototype,"postMessage",null),a}(m.Component),Z=function(p){x(a,p);function a(e,r){var s=p.call(this,e)||this,t=r;return t.registerComponent(s),s}return a.prototype.componentWillUnmount=function(){var e=this.context;e.unRegisterComponent(this),p.prototype.componentWillUnmount.call(this)},a.contextType=B,a=g([W({type:"iframe"}),n("design:paramtypes",[Object,Object])],a),a}(P);export{Z as IFrameRenderer,P as default};

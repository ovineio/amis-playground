import{a as O,R as N,h as L,k as A,r as R,E as x,u as U,d as h,j as S,l as W,F as B,U as j,V as z,e as y,p as w,q as n,s as D,f as k,dF as J,dG as P,aj as T}from"./index-12050af9.js";var V=function(p){O(a,p);function a(){var t=p!==null&&p.apply(this,arguments)||this;return t.IFrameRef=N.createRef(),t.state={width:t.props.width||"100%",height:t.props.height||"100%"},t}return a.prototype.componentDidMount=function(){window.addEventListener("message",this.onMessage)},a.prototype.componentDidUpdate=function(t){var r=this.props.data;r!==t.data?this.postMessage("update",r):(this.props.width!==t.width||this.props.height!==t.height)&&this.setState({width:this.props.width||"100%",height:this.props.height||"100%"})},a.prototype.componentWillUnmount=function(){window.removeEventListener("message",this.onMessage)},a.prototype.validateURL=function(t){return t&&typeof t=="string"&&/^data:([a-zA-Z0-9]+\/[a-zA-Z0-9]+);base64,.*/.test(t)?!0:!(t&&typeof t=="string"&&!/^(\.\/|\.\.\/|\/|(blob\:)?https?\:\/\/|\/\/)/.test(t))},a.prototype.onMessage=function(t){var r,s,e;return L(this,void 0,void 0,function(){var i,u,m,b,g,d,_,o,v,f,c;return A(this,function(l){switch(l.label){case 0:return i=this.props,u=i.events,m=i.onEvent,b=i.onAction,g=i.data,typeof((r=t==null?void 0:t.data)===null||r===void 0?void 0:r.type)!="string"?[2]:(d=T(t.data.type.split(":"),2),_=d[0],o=d[1],_!=="amis"||!o?[2]:o==="resize"&&t.data.data?(this.setState({width:t.data.data.width||"100%",height:t.data.data.height||"100%"}),[3,4]):[3,1]);case 1:return v=m==null?void 0:m[o],v&&(!((s=v.actions)===null||s===void 0)&&s.length)?(f=J(o,{env:(e=this.props)===null||e===void 0?void 0:e.env,nativeEvent:t,data:x(g,t.data.data),scoped:this.context}),[4,P(v.actions,this,f)]):[3,3];case 2:if(l.sent(),f.prevented)return[2];l.label=3;case 3:u&&(c=u[o],c&&b(t,c,x(g,t.data.data))),l.label=4;case 4:return[2]}})})},a.prototype.onLoad=function(){var t=this.props,r=t.src,s=t.data;r&&this.postMessage("init",s)},a.prototype.reload=function(t,r){if(r)return this.receive(r);var s=this.props,e=s.src,i=s.data;e&&(this.IFrameRef.current.src=R(e,i,"| raw"))},a.prototype.receive=function(t){var r=this.props,s=r.src,e=r.data,i=x(e,t);this.postMessage("receive",i),U(s,s,e,i)&&(this.IFrameRef.current.src=R(s,i,"| raw"))},a.prototype.postMessage=function(t,r){var s,e;(e=(s=this.IFrameRef.current)===null||s===void 0?void 0:s.contentWindow)===null||e===void 0||e.postMessage({type:"amis:".concat(t),data:JSON.parse(JSON.stringify(r))},"*")},a.prototype.render=function(){var t=this.state,r=t.width,s=t.height,e=this.props,i=e.className,u=e.src,m=e.name,b=e.frameBorder,g=e.data,d=e.style,_=e.allow,o=e.sandbox,v=e.referrerpolicy,f=e.translate,c=e.id,l=e.wrapperCustomStyle,I=e.env,M=e.themeCss;e.baseControlClassName;var E=e.classnames,F={};r!==void 0&&(F.width=r),s!==void 0&&(F.height=s),d=h(h({},F),d);var C=u?R(u,g,"| raw"):void 0;return this.validateURL(C)?(location.protocol==="https:"&&C&&C.startsWith("http://")&&I.notify("error",f("Iframe.invalidProtocol")),W(B,{children:[S("iframe",{name:m,className:E("IFrame",i,j(h(h({},this.props),{name:"baseControlClassName",id:c,themeCss:M})),j(h(h({},this.props),{name:"wrapperCustomStyle",id:c,themeCss:l}))),frameBorder:b,style:d,ref:this.IFrameRef,onLoad:this.onLoad,src:C,allow:_,referrerPolicy:v,sandbox:o}),S(z,{...h({},this.props,{config:{wrapperCustomStyle:l,id:c,themeCss:M,classNames:[{key:"baseControlClassName"}]},env:I})})]})):S("p",{children:f("Iframe.invalid")})},a.propsList=["src","className"],a.defaultProps={className:"",frameBorder:0},y([w,n("design:type",Function),n("design:paramtypes",[MessageEvent]),n("design:returntype",Promise)],a.prototype,"onMessage",null),y([w,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],a.prototype,"onLoad",null),y([w,n("design:type",Function),n("design:paramtypes",[Object,Object]),n("design:returntype",void 0)],a.prototype,"reload",null),y([w,n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",void 0)],a.prototype,"receive",null),y([w,n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",void 0)],a.prototype,"postMessage",null),a}(N.Component),G=function(p){O(a,p);function a(t,r){var s=p.call(this,t)||this,e=r;return e.registerComponent(s),s}return a.prototype.componentWillUnmount=function(){var t=this.context;t.unRegisterComponent(this),p.prototype.componentWillUnmount.call(this)},a.contextType=D,a=y([k({type:"iframe"}),n("design:paramtypes",[Object,Object])],a),a}(V);export{G as IFrameRenderer,V as default};

import{a as x,b2 as F,d as f,l as u,X as l,j as r,I,cE as m,h as S,k as N,b4 as b,F as T,bU as L,S as V,cF as k,aV as v,ap as M,e as d,p,q as o,R as P,C as R,cG as _}from"./index-26b02238.js";var w=function(g){x(t,g);function t(e){var n=g.call(this,e)||this;return n.state={activeTypeIndex:0,showModal:!1,tmpCheckIconId:null,searchValue:"",isRefreshLoading:!1},n.handleSearchValueChange=F(n.handleSearchValueChange.bind(n),300),n}return t.prototype.getSvgName=function(e){var n;return typeof e=="string"?((n=/data-name="(.*?)"/.exec(e))===null||n===void 0?void 0:n[1])||"":(e==null?void 0:e.name)||(e==null?void 0:e.id)||""},t.prototype.getSvgId=function(e){var n;return typeof e=="string"?((n=/data-id="(.*?)"/.exec(e))===null||n===void 0?void 0:n[1])||"":(e==null?void 0:e.id)||""},t.prototype.getValueBySvg=function(e){var n;if(!e)return null;if(typeof e!="string")return f(f({},e),{svg:(n=e.svg)===null||n===void 0?void 0:n.replace(/'/g,"")});var a=this.getSvgName(e),i=this.getSvgId(e);return{name:a,id:i,svg:e.replace(/'/g,"")}},t.prototype.handleClick=function(){this.props.disabled||this.toggleModel(!0)},t.prototype.handleClear=function(e){e.preventDefault(),e.stopPropagation(),this.props.onChange&&this.props.onChange("")},t.prototype.renderInputArea=function(){var e=this.props,n=e.classPrefix,a=e.disabled,i=e.value,c=e.placeholder,h=e.clearable,s=this.getValueBySvg(i);return u("div",{className:l("".concat(n,"IconSelectControl-input-area")),children:[r("div",{className:l("".concat(n,"IconSelectControl-input-icon-show")),children:r(I,{icon:s==null?void 0:s.svg,className:"icon"})}),r("span",{className:l("".concat(n,"IconSelectControl-input-icon-id")),children:s==null?void 0:s.name}),h&&!a&&s?r("a",{onClick:this.handleClear,className:l("".concat(n,"IconSelectControl-clear")),children:r(I,{icon:"input-clear",className:"icon"})}):null,!s&&c&&r("span",{className:l("".concat(n,"IconSelectControl-input-icon-placeholder")),children:c})||null]})},t.prototype.handleIconTypeClick=function(e,n){this.setState({activeTypeIndex:n})},t.prototype.renderIconTypes=function(){var e=this,n=this.props.classPrefix,a=m.map(function(i){return{id:i.groupId,label:i.name}});return r("ul",{className:l("".concat(n,"IconSelectControl-type-list")),children:a.map(function(i,c){return r("li",{onClick:function(){return e.handleIconTypeClick(i,c)},className:l({active:c===e.state.activeTypeIndex}),children:i.label},i.id)})})},t.prototype.handleConfirm=function(){var e=this.state.tmpCheckIconId;if(this.props.returnSvg){var n=e&&e.svg||"";n=n.replace(/<svg/,'<svg data-name="'.concat(e==null?void 0:e.name,'" data-id="').concat(e==null?void 0:e.id,'"')),this.props.noSize&&(n=n.replace(/width=".*?"/,"").replace(/height=".*?"/,"")),this.props.onChange&&this.props.onChange(n)}else this.props.onChange&&this.props.onChange(e&&e.id?f(f({},e),{id:"svg-"+e.id}):"");this.toggleModel(!1)},t.prototype.handleLocalUpload=function(e){return S(this,void 0,void 0,function(){return N(this,function(n){return this.props.onChange&&this.props.onChange(e),this.toggleModel(!1),[2]})})},t.prototype.handleClickIconInModal=function(e){var n;this.setState({tmpCheckIconId:(e==null?void 0:e.id)===((n=this.state.tmpCheckIconId)===null||n===void 0?void 0:n.id)?null:e})},t.prototype.renderIconList=function(e){var n=this,a=this.props,i=a.classPrefix,c=a.noDataTip,h=a.translate;return!e||!e.length?r("p",{className:l("".concat(i,"IconSelectControl-icon-list-empty")),children:h(c)}):r("ul",{className:l("".concat(i,"IconSelectControl-icon-list")),children:e.map(function(s,C){var y;return r("li",{children:u("div",{className:l("".concat(i,"IconSelectControl-icon-list-item"),{active:((y=n.state.tmpCheckIconId)===null||y===void 0?void 0:y.id)===s.id}),onClick:function(){return n.handleClickIconInModal(s)},children:[r("svg",{children:r("use",{xlinkHref:"#".concat(s.id)})}),r("div",{className:l("".concat(i,"IconSelectControl-icon-list-item-info")),children:r("p",{className:l("".concat(i,"IconSelectControl-icon-list-item-info-name")),children:s.name})})]})},s.id)})})},t.prototype.handleSearchValueChange=function(e){this.setState({searchValue:e})},t.prototype.handleRefreshIconList=function(){return S(this,void 0,void 0,function(){var e,n;return N(this,function(a){switch(a.label){case 0:if(e=_,!(e&&typeof e=="function"))return[3,5];a.label=1;case 1:return a.trys.push([1,3,4,5]),this.setState({isRefreshLoading:!0}),[4,Promise.resolve(e())];case 2:return a.sent(),[3,5];case 3:return n=a.sent(),console.error(n),[3,5];case 4:return this.setState({isRefreshLoading:!1}),[7];case 5:return[2]}})})},t.prototype.renderModalContent=function(){var e=this.props,n=e.render,a=e.classPrefix,i=e.loadingConfig;e.funcSchema;var c=e.funcCom,h=this.getIconsByType(),s=this.state.searchValue,C=s?b(h,s,{keys:["name"],threshold:b.rankings.CONTAINS}):h;return u(T,{children:[r(L,{className:l("".concat(a,"IconSelectControl-Modal-search")),mini:!1,clearable:!0,onChange:this.handleSearchValueChange}),_&&n("refresh-btn",{type:"button",icon:"fa fa-refresh"},{className:l("".concat(a,"IconSelectControl-Modal-refresh")),onClick:this.handleRefreshIconList})||null,c?r("div",{className:l("".concat(a,"IconSelectControl-Modal-func")),children:r(c,{onUpload:this.handleLocalUpload})}):null,u("div",{className:l("".concat(a,"IconSelectControl-Modal-content")),children:[r(V,{size:"lg",loadingConfig:i,overlay:!0,show:this.state.isRefreshLoading},"info"),r("div",{className:l("".concat(a,"IconSelectControl-Modal-content-aside")),children:this.renderIconTypes()}),r("div",{className:l("".concat(a,"IconSelectControl-Modal-content-main")),children:this.renderIconList(C)})]})]})},t.prototype.getIconsByType=function(){return(k===null||k===void 0?void 0:m.length)&&m[this.state.activeTypeIndex].children||[]},t.prototype.toggleModel=function(e){var n=this.props.value,a=typeof n=="string"?this.getValueBySvg(n):n;if(e===void 0){this.setState({showModal:!this.state.showModal,searchValue:""});return}this.setState({showModal:e,tmpCheckIconId:e&&(a!=null&&a.id)?f(f({},a),{id:String(a.id).replace(/^svg-/,"")}):null,searchValue:""})},t.prototype.render=function(){var e=this,n=this.props,a=n.className;n.style;var i=n.classPrefix,c=n.disabled,h=n.translate;return u("div",{className:l(a,"".concat(i,"IconSelectControl"),{"is-focused":this.state.showModal,"is-disabled":c}),children:[r("div",{className:l("".concat(i,"IconSelectControl-input")),onClick:this.handleClick,children:this.renderInputArea()}),u(v,{show:this.state.showModal,closeOnOutside:!0,closeOnEsc:!0,size:"lg",overlay:!0,onHide:function(){return e.toggleModel(!1)},children:[r(v.Header,{onClose:function(){return e.toggleModel(!1)},children:h("IconSelect.choice")}),r(v.Body,{children:this.renderModalContent()}),u(v.Footer,{children:[r(M,{type:"button",className:"m-l",onClick:function(){return e.toggleModel(!1)},children:h("cancel")}),r(M,{type:"button",level:"primary",onClick:this.handleConfirm,children:h("confirm")})]})]})]})},t.defaultProps={noDataTip:"placeholder.noData",clearable:!0},d([p,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],t.prototype,"handleClick",null),d([p,o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",void 0)],t.prototype,"handleClear",null),d([p,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],t.prototype,"renderInputArea",null),d([p,o("design:type",Function),o("design:paramtypes",[Object,Number]),o("design:returntype",void 0)],t.prototype,"handleIconTypeClick",null),d([p,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],t.prototype,"renderIconTypes",null),d([p,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],t.prototype,"handleConfirm",null),d([p,o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],t.prototype,"handleLocalUpload",null),d([p,o("design:type",Function),o("design:paramtypes",[Array]),o("design:returntype",void 0)],t.prototype,"renderIconList",null),d([p,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],t.prototype,"handleRefreshIconList",null),d([p,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],t.prototype,"renderModalContent",null),d([p,o("design:type",Function),o("design:paramtypes",[Boolean]),o("design:returntype",void 0)],t.prototype,"toggleModel",null),t}(P.PureComponent),O=function(g){x(t,g);function t(){return g!==null&&g.apply(this,arguments)||this}return t=d([R({type:"icon-select"})],t),t}(w);export{O as IconSelectControlRenderer,w as default};

import{a as A,a5 as F,an as D,aC as j,c6 as w,ad as P,cf as W,h as _,k as C,_ as T,bm as B,aq as O,j as E,cg as N,l as z,d as R,e as I,p as S,q as y,R as U,C as M,Y as J}from"./index-12050af9.js";var L=function(x){A(p,x);function p(){var t=x!==null&&x.apply(this,arguments)||this;return t.state={filename:""},t}return p.prototype.componentDidUpdate=function(t){t.value!==this.props.value&&!this.props.value&&this.setState({filename:""})},p.prototype.syncAutoFill=function(t){var n=this.props,a=n.autoFill,o=n.onBulkChange,l=n.data,c=n.name;if(!(a!=null&&a.hasOwnProperty("api")||!F(a))){var e=c?D(a,c):a;if(!j(e)&&o){var i=w(e,{filename:t});Object.keys(i).forEach(function(r){P(i[r])&&P(l[r])&&(i[r]=W({},l[r],i[r]))}),o(i)}}},p.prototype.handleDrop=function(t){var n=this,a=t[0],o=a.name,l=new FileReader;l.readAsArrayBuffer(a),l.onload=function(){return _(n,void 0,void 0,function(){var c=this;return C(this,function(e){return l.result&&(o.toLowerCase().endsWith(".xls")?T(()=>import("./xlsx-6ed613d4.js"),[]).then(function(i){var r=i.read(new Uint8Array(l.result),{cellDates:!0}),h=i.writeXLSX(r,{type:"array"});c.processExcelFile(h,o)}):this.processExcelFile(l.result,o)),[2]})})}},p.prototype.processExcelFile=function(t,n){var a=this,o=this.props,l=o.allSheets,c=o.onChange,e=o.parseImage,i=o.autoFill;T(()=>import("./exceljs.min-14a0925a.js").then(r=>r.e),["assets/exceljs.min-14a0925a.js","assets/index-12050af9.js","assets/index-3250bc9b.css"]).then(function(r){return _(a,void 0,void 0,function(){var h,d,s,u,m,v,f=this;return C(this,function(b){switch(b.label){case 0:return h=r.default||r,this.ExcelJS=h,d=new h.Workbook,[4,d.xlsx.load(t)];case 1:return b.sent(),s=[],l?d.eachSheet(function(g){var k=g.state||"visible";k!=="hidden"&&(e?s.push({sheetName:g.name,data:f.readWorksheet(g),images:f.readImages(g,d)}):s.push({sheetName:g.name,data:f.readWorksheet(g)}))}):(u=d.worksheets.find(function(g){return g.state!=="hidden"}),e?(m=this.readImages(u,d),s={data:this.readWorksheet(u),images:m}):s=this.readWorksheet(u)),[4,this.dispatchEvent("change",s)];case 2:return v=b.sent(),v!=null&&v.prevented?[2]:(c(s),i&&this.syncAutoFill(n),this.setState({filename:n}),[2])}})})})},p.prototype.readImages=function(t,n){var a,o,l=this.props.imageDataURI,c=t.getImages(),e=[];try{for(var i=B(c),r=i.next();!r.done;r=i.next()){var h=r.value,d=n.getImage(+h.imageId),s=this.encodeBase64Bytes(d.buffer);if(l){var u=d.extension||"png";e.push("data:image/".concat(u,";base64,")+s)}else e.push(s)}}catch(m){a={error:m}}finally{try{r&&!r.done&&(o=i.return)&&o.call(i)}finally{if(a)throw a.error}}return e},p.prototype.encodeBase64Bytes=function(t){return btoa(t.reduce(function(n,a){return n+String.fromCharCode(a)},""))},p.prototype.dispatchEvent=function(t,n){return _(this,void 0,void 0,function(){var a,o;return C(this,function(l){switch(l.label){case 0:return a=this.props,o=a.dispatchEvent,a.data,[4,o(t,J(this.props,{value:n}))];case 1:return[2,l.sent()]}})})},p.prototype.isRichTextValue=function(t){return!!(t&&F(t)&&t.hasOwnProperty("richText")&&Array.isArray(t==null?void 0:t.richText))},p.prototype.richText2PlainString=function(t,n){n===void 0&&(n=!1);var a=t.richText.map(function(o){var l=o.text,c=o.font,e=c===void 0?{}:c,i=l;if(n){var r="",h=e!=null&&e.bold?"strong":e!=null&&e.italic?"em":(e==null?void 0:e.vertAlign)==="superscript"?"sup":(e==null?void 0:e.vertAlign)==="subscript"?"sub":"span";e!=null&&e.strike?r+="text-decoration: line-through;":e!=null&&e.underline&&(r+="text-decoration: underline;"),e!=null&&e.outline&&(r+="outline: solid;"),e!=null&&e.size&&(r+="font-size: ".concat(e.size,"px;")),i="<".concat(h," ").concat(r?"style=".concat(r):"",">").concat(l,"</").concat(h,">")}return i});return a.join("")},p.prototype.readWorksheet=function(t){var n=this,a=[],o=this.props,l=o.parseMode,c=o.plainText,e=o.includeEmpty;if(l==="array")return t.eachRow(function(r,h){var d=r.values;d.shift(),c&&(d=d.map(function(s){if(s instanceof Object){if(s.hyperlink)return s.hyperlink.startsWith("mailto:")?s.hyperlink.substring(7):s.hyperlink;if(s.result)return s.result;if(s.richText)return n.richText2PlainString(s)}return s})),a.push(d)}),a;var i=[];return t.eachRow(function(r,h){var d;if(h==1)i=((d=r.values)!==null&&d!==void 0?d:[]).map(function(u){return n.isRichTextValue(u)?n.richText2PlainString(u):u});else{var s={};e&&i.forEach(function(u){s[u]=""}),r.eachCell(function(u,m){if(i[m]){var v=u.value;if(c){var f=n.ExcelJS.ValueType;u.type===f.Hyperlink?(v=u.value.hyperlink,v.startsWith("mailto:")&&(v=v.substring(7))):u.type===f.Formula?v=u.value.result:u.type===f.RichText?v=n.richText2PlainString(u.value):u.type===f.Error&&(v="")}s[i[m]]=v}}),a.push(s)}}),a},p.prototype.doAction=function(t,n,a){var o,l,c=t==null?void 0:t.actionType,e=this.props,i=e.onChange,r=e.resetValue,h=e.formStore,d=e.store,s=e.name;if(c==="clear")i("");else if(c==="reset"){var u=(l=O((o=h==null?void 0:h.pristine)!==null&&o!==void 0?o:d==null?void 0:d.pristine,s))!==null&&l!==void 0?l:r;i(u??"")}},p.prototype.render=function(){var t=this,n=this.props,a=n.className,o=n.classnames;n.classPrefix;var l=n.disabled,c=n.translate,e=n.placeholder,i=n.testIdBuilder;return E("div",{className:o("ExcelControl",a),children:E(N,{onDrop:this.handleDrop,accept:".xlsx,.xls",multiple:!1,disabled:l,children:function(r){var h=r.getRootProps,d=r.getInputProps;return E("section",{className:o("ExcelControl-container",a),children:z("div",{...R({},h({className:o("ExcelControl-dropzone")}),i==null?void 0:i.getTestId()),children:[E("input",{...R({},d(),i==null?void 0:i.getChild("input").getTestId())}),t.state.filename?c("Excel.parsed",{filename:t.state.filename}):E("p",{children:e??c("Excel.placeholder")})]})})}},"drop-zone")})},p.defaultProps={allSheets:!1,parseMode:"object",includeEmpty:!0,plainText:!0,parseImage:!1,imageDataURI:!0},I([S,y("design:type",Function),y("design:paramtypes",[String]),y("design:returntype",void 0)],p.prototype,"syncAutoFill",null),I([S,y("design:type",Function),y("design:paramtypes",[Array]),y("design:returntype",void 0)],p.prototype,"handleDrop",null),p}(U.PureComponent),H=function(x){A(p,x);function p(){return x!==null&&x.apply(this,arguments)||this}return p=I([M({type:"input-excel"})],p),p}(L);export{H as ExcelControlRenderer,L as default};

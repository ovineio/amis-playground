import{a as B,aT as j,E as x,d as n,a6 as k,aJ as z,ai as U,an as _,l as b,F as q,j as d,I as S,X as H,bh as J,e as O,p as W,q as D,R as X,C as $}from"./index-26b02238.js";var I,L=function(h){return h&&(I=I||document.createElement("div"),I.innerHTML=h,I.innerText)},G=function(h){B(r,h);function r(a){var e=h.call(this,a)||this;return e.state={},e.id=j(),e.addItem=e.addItem.bind(e),e.removeItem=e.removeItem.bind(e),e.editSingle=e.editSingle.bind(e),e.open=e.open.bind(e),e.close=e.close.bind(e),e.dragTipRef=e.dragTipRef.bind(e),e.handleDialogConfirm=e.handleDialogConfirm.bind(e),e}return r.prototype.addItem=function(){this.setState({dialogData:x(this.props.data,this.props.scaffold||{}),dialogCtx:{mode:"add"}})},r.prototype.removeItem=function(a){a.stopPropagation(),a.preventDefault();var e=parseInt(a.currentTarget.getAttribute("data-index"),10),l=this.props.value;Array.isArray(l)&&(l=l.concat(),l.splice(e,1),this.props.onChange(l))},r.prototype.editSingle=function(){var a=this.props.value;a?this.setState({dialogData:x(this.props.data,this.props.value),dialogCtx:{mode:"edit"}}):this.addItem()},r.prototype.open=function(a){var e=parseInt(a.currentTarget.getAttribute("data-index"),10),l=this.props.value;!Array.isArray(l)||!l[e]||(this.tempValue=l[e],this.setState({dialogData:x(this.props.data,l[e]),dialogCtx:{mode:"edit",index:e}}))},r.prototype.close=function(){this.setState({dialogData:void 0,dialogCtx:void 0})},r.prototype.handleDialogConfirm=function(a){var e=this.props,l=e.multiple,u=e.onChange,i=e.value,t=this.state.dialogCtx;if(l){var o=Array.isArray(i)?i.concat():[];(t==null?void 0:t.mode)==="add"?o.push(n({},a[0])):o[t.index]=n(n({},o[t.index]),a[0]),u(o)}else u(n(n({},i),a[0]));this.close()},r.prototype.handlePopupConfirm=function(){var a=this.tempValue,e=this.props,l=e.multiple,u=e.onChange,i=e.value,t=this.state.dialogCtx;if(l){var o=Array.isArray(i)?i.concat():[];(t==null?void 0:t.mode)==="add"?o.push(n({},a)):o[t.index]=n(n({},o[t.index]),a),u(o)}else u(n(n({},i),a));this.close()},r.prototype.dragTipRef=function(a){!this.dragTip&&a?this.initDragging():this.dragTip&&!a&&this.destroyDragging(),this.dragTip=a},r.prototype.initDragging=function(){var a=this,e=this.props.classPrefix,l=this.props.submitOnChange,u=k.findDOMNode(this);this.sortable=new z(u.querySelector(".".concat(e,"SubForm-values")),{group:"SubForm-".concat(this.id),animation:150,handle:".".concat(e,"SubForm-valueDragBar"),ghostClass:"".concat(e,"SubForm-value--dragging"),onEnd:function(i){if(i.newIndex!==i.oldIndex){var t=i.to;i.oldIndex<t.childNodes.length-1?t.insertBefore(i.item,t.childNodes[i.oldIndex>i.newIndex?i.oldIndex+1:i.oldIndex]):t.appendChild(i.item);var o=a.props.value;if(Array.isArray(o)){var p=o.concat();p.splice(i.newIndex,0,p.splice(i.oldIndex,1)[0]),a.props.onChange(p,l,!0)}}}})},r.prototype.destroyDragging=function(){this.sortable&&this.sortable.destroy()},r.prototype.buildDialogSchema=function(){var a=this.props.form,e=["title","actions","name","size","closeOnEsc","closeOnOutside","showErrorMsg","showCloseButton","bodyClassName","type"];return n(n({},U(a,e)),{type:"dialog",body:n(n({type:"form",canAccessSuperData:!1},_(a,e)),{inheritData:!1})})},r.prototype.buildFormSchema=function(){var a=this.props.form,e=["title","actions","name","size","closeOnEsc","closeOnOutside","showErrorMsg","showCloseButton","bodyClassName","type"];return n(n({type:"form",canAccessSuperData:!1},_(a,e)),{inheritData:!1})},r.prototype.renderMultipe=function(){var a=this,e=this.props,l=e.addButtonClassName,u=e.itemClassName,i=e.itemsClassName,t=e.disabled,o=e.maxLength,p=e.labelField,v=e.defaultLabel,s=e.value,g=e.btnLabel,f=e.render,y=e.data,c=e.translate,m=e.classnames,P=e.placeholder,A=e.draggable,E=e.draggableTip,M=e.addable,R=e.removable,T=e.minLength,w=e.addButtonText,C=e.testIdBuilder;return b(q,{children:[Array.isArray(s)&&s.length?d("div",{className:m("SubForm-values",i),children:s.map(function(N,F){return b("div",{...n({className:m("SubForm-value",{"is-disabled":t},u),key:F},C==null?void 0:C.getChild("item-".concat(F)).getTestId()),children:[A&&s.length>1?d("a",{className:m("SubForm-valueDragBar"),children:d(S,{icon:"drag-bar",className:m("icon")})}):null,b("span",{className:m("SubForm-valueLabel"),children:[g&&f("label",{type:"tpl",tpl:c(g)},{data:x(y,N)}),!g&&(N&&p&&N[p]&&L(N[p])||c(v))]}),d("a",{"data-index":F,onClick:a.open,className:m("SubForm-valueEdit"),children:d(S,{icon:"pencil",className:"icon"})}),!t&&R!==!1&&(!T||s.length>T)?d("a",{"data-index":F,className:m("SubForm-valueDel"),onClick:a.removeItem,children:d(S,{icon:"close",className:"icon"})}):null]})})},"values"):d("div",{className:m("SubForm-placeholder"),children:c(P||"placeholder.empty")},"placeholder"),b("div",{className:m("SubForm-toolbar"),children:[M!==!1?b("button",{...n({type:"button",onClick:this.addItem,className:m("Button SubForm-addBtn",l),disabled:t||!!(o&&Array.isArray(s)&&s.length>=o)},C==null?void 0:C.getChild("add-button").getTestId()),children:[d(S,{icon:"plus",className:"icon"}),d("span",{children:c(w||"SubForm.add")})]}):null,A&&Array.isArray(s)&&s.length>1?d("span",{className:m("Combo-dragableTip"),ref:this.dragTipRef,children:Array.isArray(s)&&s.length>1?c(E):""}):null]},"toolbar")]})},r.prototype.renderSingle=function(){var a=this.props,e=a.classnames,l=a.itemsClassName,u=a.itemClassName,i=a.disabled,t=a.value,o=a.labelField,p=a.defaultLabel,v=a.btnLabel,s=a.render,g=a.data,f=a.translate,y=a.testIdBuilder,c=y==null?void 0:y.getChild("edit-single");return d("div",{className:e("SubForm-values",l),children:b("div",{...n({className:e("SubForm-value",{"is-disabled":i},u),onClick:this.editSingle,"data-tooltip":f("SubForm.editDetail"),"data-position":"bottom"},c==null?void 0:c.getTestId()),children:[b("span",{className:e("SubForm-valueLabel"),children:[v&&s("label",{type:"tpl",tpl:f(v)},{data:x(g,t)}),!v&&(t&&o&&t[o]&&L(t[o])||f(p))]}),d("a",{...n({className:e("SubForm-valueEdit")},c==null?void 0:c.getChild("icon").getTestId()),children:d(S,{icon:"pencil",className:"icon"})})]})},"values")},r.prototype.render=function(){var a=this,e=this.props,l=e.multiple,u=e.classPrefix,i=e.className;e.style;var t=e.render,o=e.mobileUI,p=e.env,v=e.popOverContainer,s=this.state.dialogData,g=this.state.dialogCtx;return b("div",{className:H("".concat(u,"SubFormControl"),i),children:[l?this.renderMultipe():this.renderSingle(),o?d(J,{isShow:!!g,showConfirm:!0,onConfirm:this.handlePopupConfirm,onHide:this.close,container:o?p==null?void 0:p.getModalContainer:v||p.getModalContainer,children:d("div",{className:"flex-1 pl-10 pr-10",children:t("form",this.buildFormSchema(),{data:s,formStore:void 0,wrapWithPanel:!1,onChange:function(f){a.tempValue=f}})})}):t("modal",this.buildDialogSchema(),{show:!!g,onClose:this.close,onConfirm:this.handleDialogConfirm,data:s,formStore:void 0})]})},r.defaultProps={minLength:0,maxLength:0,multiple:!1,btnClassName:"",addButtonClassName:"",itemClassName:"",labelField:"label",defaultLabel:"SubForm.button",placeholder:"placeholder.empty"},r.propsList=["form","formStore"],O([W,D("design:type",Function),D("design:paramtypes",[]),D("design:returntype",void 0)],r.prototype,"handlePopupConfirm",null),r}(X.PureComponent),Q=function(h){B(r,h);function r(){return h!==null&&h.apply(this,arguments)||this}return r=O([$({type:"input-sub-form",sizeMutable:!1,strictMode:!1})],r),r}(G);export{Q as SubFormControlRenderer,G as default};

import{a as K,R as z,aq as J,h as I,k as C,bb as X,bc as Z,as as ee,aj as te,bd as ne,be as _,a6 as ie,bf as ae,j as m,b3 as re,l as A,bg as L,d as R,S as se,bh as oe,bi as D,P as le,Q as ue,e as c,p as h,q as o,a_ as de,b9 as pe,Y as ce,al as he,b4 as $}from"./index-26b02238.js";var ve=function(V){K(s,V);function s(e){var t=V.call(this,e)||this;return t.input=z.createRef(),t.state={isOpened:!1,inputValue:"",isFocused:!1,selectedOptions:e.selectedOptions,cacheOptions:[]},t}return s.prototype.componentDidUpdate=function(e){var t=this.props;e.value!==t.value&&this.setState({inputValue:""})},s.prototype.doAction=function(e,t,a){var n,r,i=this.props,u=i.resetValue,l=i.onChange,d=i.formStore,p=i.store,v=i.name,F=e==null?void 0:e.actionType;if(F==="clear")l==null||l("");else if(F==="reset"){var y=(r=J((n=d==null?void 0:d.pristine)!==null&&n!==void 0?n:p==null?void 0:p.pristine,v))!==null&&r!==void 0?r:u;l==null||l(y??"")}},s.prototype.dispatchEvent=function(e,t){return t===void 0&&(t={}),I(this,void 0,void 0,function(){var a,n,r,i;return C(this,function(u){switch(u.label){case 0:return a=this.props,n=a.dispatchEvent,r=a.options,[4,n(e,ce(this.props,R({options:r,items:r},t)))];case 1:return i=u.sent(),[2,!!(i!=null&&i.prevented)]}})})},s.prototype.normalizeInputValue=function(e){var t=this.props,a=t.enableBatchAdd,n=t.separator,r=t.valueField,i=t.labelField,u=t.delimiter,l=[];if(a&&n&&typeof n=="string")l=e.split(n);else{var d=X(Z(e.split(u||",")));l.push.apply(l,ee([],te(d),!1))}return l.filter(Boolean).map(function(p){var v;return v={},v["".concat(r||"value")]=p,v["".concat(i||"label")]=p,v})},s.prototype.normalizeOptions=function(e){var t=this.props,a=t.joinValues,n=t.extractValue,r=t.delimiter,i=t.valueField;return a?e.map(function(u){return u[i||"value"]}).join(r||","):n?e.map(function(u){return u[i||"value"]}):e},s.prototype.normalizeMergedValue=function(e,t){t===void 0&&(t=!0);var a=this.props,n=a.selectedOptions,r=a.valueField,i=ne(n.concat(),this.normalizeInputValue(e),function(u,l){return u[r||"value"]===l[r||"value"]});return t?this.normalizeOptions(i):i},s.prototype.validateInputValue=function(e){var t=this.props,a=t.max,n=t.maxTagLength;t.enableBatchAdd,t.separator;var r=t.onInputValidateFailed,i=t.valueField,u=this.normalizeMergedValue(e,!1);if(a!=null&&_(a)&&u.length>a)return r==null||r(u.map(function(d){return d[i||"value"]}),"max"),!1;var l=this.normalizeInputValue(e);return n!=null&&_(n)&&l.some(function(d){return d[i||"value"].length>n})?(r==null||r(l.map(function(d){return d[i||"value"]}),"maxLength"),!1):!0},s.prototype.getValue=function(e,t,a){e===void 0&&(e="normal"),t===void 0&&(t={});var n=this.props,r=n.joinValues,i=n.extractValue,u=n.delimiter,l=n.valueField;a=a||this.props.selectedOptions;var d=a.concat();return e==="push"?d.push(t):e==="pop"&&d.pop(),r?d.map(function(p){return p[l||"value"]}).join(u||","):i?d.map(function(p){return p[l||"value"]}):d},s.prototype.addItem=function(e){return I(this,void 0,void 0,function(){var t,a,n,r,i,u,l;return C(this,function(d){switch(d.label){case 0:return this.isReachMax()?[2]:(t=this.props,a=t.selectedOptions,n=t.onChange,r=t.valueField,i=a.concat(),he(i,function(p){return p[r||"value"]==e[r||"value"]})?[2]:(u=this.getValue("push",e),[4,this.dispatchEvent("change",{value:u,selectedItems:a.concat(e)})]));case 1:return l=d.sent(),l||n(u),[2]}})})},s.prototype.addItem2=function(e){var t=this.props,a=t.mobileUI,n=t.valueField,r=n===void 0?"value":n;if(a){var i=this.state.selectedOptions.concat(),u=i.findIndex(function(l){return l[r]===e[r]});~u?i.splice(u,1):this.isReachMaxFromState()||i.push(e),this.setState({selectedOptions:i})}},s.prototype.isExist=function(e){var t=this.props,a=t.options,n=t.valueField,r=n===void 0?"value":n,i=this.state.cacheOptions;return a.some(function(u){return u[r]===e})||i.some(function(u){return u[r]===e})},s.prototype.addSelection=function(){var e=this.state.inputValue,t=this.props.maxTagLength,a=this.state.selectedOptions.slice(),n=this.state.cacheOptions.slice();if(t!==void 0&&(e=e.trim(),e=e.slice(0,t)),!this.isExist(e)&&e&&!this.isReachMaxFromState()){var r=this.normalizeInputValue(e);a.push(r[0]),n.push(r[0]),this.setState({inputValue:"",selectedOptions:a,cacheOptions:n})}},s.prototype.onConfirm=function(){return I(this,void 0,void 0,function(){var e,t,a,n;return C(this,function(r){switch(r.label){case 0:return e=this.state.selectedOptions,t=this.props.onChange,a=this.getValue("normal",{},e),[4,this.dispatchEvent("change",{value:a,selectedItems:e})];case 1:return n=r.sent(),n||t(a),this.close(),[2]}})})},s.prototype.handleFocus=function(e){var t,a;return I(this,void 0,void 0,function(){var n,r;return C(this,function(i){switch(i.label){case 0:return this.setState({isFocused:!0,isOpened:!0,selectedOptions:this.props.selectedOptions}),n=this.getValue("normal"),[4,this.dispatchEvent("focus",{value:n,selectedItems:this.props.selectedOptions})];case 1:return r=i.sent(),r||((a=(t=this.props).onFocus)===null||a===void 0||a.call(t,e)),[2]}})})},s.prototype.handleBlur=function(e){var t,a;return I(this,void 0,void 0,function(){var n,r,i,u,l,d,p,v;return C(this,function(F){switch(F.label){case 0:return n=this.props,r=n.selectedOptions,i=n.onChange,u=n.mobileUI,l=n.options,u&&l.length?[2]:(d=this.state.inputValue.trim(),this.validateInputValue(d)?(p=this.normalizeMergedValue(d),[4,this.dispatchEvent("blur",{value:p,selectedItems:r})]):(this.setState({isFocused:!1,isOpened:!1}),[2]));case 1:return v=F.sent(),v||((a=(t=this.props).onBlur)===null||a===void 0||a.call(t,e)),this.setState({isFocused:!1,isOpened:!1,inputValue:""},d?function(){r.length!==p.length&&(i==null||i(p))}:void 0),[2]}})})},s.prototype.close=function(){this.setState({isOpened:!1})},s.prototype.handleInputChange=function(e){this.setState({inputValue:e})},s.prototype.handleChange=function(e){return I(this,void 0,void 0,function(){var t,a,n,r,i,u,l,d;return C(this,function(p){switch(p.label){case 0:return t=this.props,a=t.joinValues,n=t.extractValue,r=t.delimiter,i=t.valueField,u=t.onChange,l=Array.isArray(e)?e.concat():[],(a||n)&&(l=e.map(function(v){return v[i||"value"]})),a&&(l=l.join(r||",")),[4,this.dispatchEvent("change",{value:l,selectedItems:e})];case 1:return d=p.sent(),d||u(l),[2]}})})},s.prototype.renderItem=function(e){var t=this.props.labelField;return"".concat(e[t||"label"])},s.prototype.handleKeyDown=function(e){return I(this,void 0,void 0,function(){var t,a,n,r,i,u,l,d,l,d;return C(this,function(p){switch(p.label){case 0:return t=this.props,a=t.selectedOptions,n=t.onChange,r=t.delimiter,t.labelField,t.valueField,i=this.state.inputValue.trim(),u=a.concat(this.normalizeMergedValue(i,!1)),a.length&&!i&&e.key=="Backspace"?(l=this.getValue("pop"),[4,this.dispatchEvent("change",{value:l,selectedItems:u})]):[3,2];case 1:return d=p.sent(),d||n(l),[3,5];case 2:return i&&(e.key==="Enter"||e.key===r)?(e.preventDefault(),e.stopPropagation(),l=this.normalizeMergedValue(i),[4,this.dispatchEvent("change",{value:l,selectedItems:u})]):[3,4];case 3:return d=p.sent(),this.validateInputValue(i)?(!d&&a.length!==l.length&&n(l),this.setState({inputValue:""}),[3,5]):(this.setState({isFocused:!1,isOpened:!1}),[2]);case 4:!i&&e.key==="Enter"&&this.handleBlur(e),p.label=5;case 5:return[2]}})})},s.prototype.handleOptionChange=function(e){var t=this.props.mobileUI;if(t){this.addItem2(e);return}this.isReachMax()||!e||this.addItem(e)},s.prototype.getTarget=function(){return this.input.current},s.prototype.getParent=function(){return this.input.current&&ie.findDOMNode(this.input.current).parentElement},s.prototype.reload=function(){var e=this.props.reloadOptions;e==null||e()},s.prototype.isReachMax=function(){var e=this.props,t=e.max,a=e.selectedOptions;return t!=null&&_(t)&&a.length>=t},s.prototype.isReachMaxFromState=function(){var e=this.state.selectedOptions,t=this.props.max;return t!=null&&_(t)&&e.length>=t},s.prototype.render=function(){var e=this,t=this.props,a=t.className;t.style;var n=t.classnames,r=t.disabled,i=t.placeholder,u=t.name,l=t.clearable,d=t.selectedOptions,p=t.loading,v=t.popOverContainer,F=t.dropdown,y=t.options,U=t.optionsTip,k=t.maxTagCount,q=t.overflowTagPopover,M=t.translate,H=t.loadingConfig,w=t.valueField,T=t.env,g=t.mobileUI,Q=t.labelField,x=t.testIdBuilder,W=this.state.inputValue,P=Array.isArray(y)?ae(y,function(b,E,B,S){return b[w||"value"]!==void 0&&(g||!~d.indexOf(b))&&($([b].concat(S),W,{keys:[Q||"label",w||"value"],threshold:$.rankings.CONTAINS}).length||Array.isArray(b.children)&&!!b.children.length)},0,!0):[],j=this.isReachMax();return m(re,{selectedItem:d,isOpen:g?this.state.isOpened:this.state.isFocused,inputValue:this.state.inputValue,onChange:this.handleOptionChange,itemToString:this.renderItem,children:function(b){var E=b.isOpen,B=b.highlightedIndex,S=b.getItemProps,Y=b.getInputProps;return A("div",{className:n(a,"TagControl"),children:[m(L,{...R({},Y({name:u,ref:e.input,placeholder:M(i??"Tag.placeholder"),value:e.state.inputValue,onKeyDown:e.handleKeyDown,onFocus:g?void 0:e.handleFocus,onBlur:e.handleBlur,disabled:r}),{onResultClick:g?e.handleFocus:void 0,inputPlaceholder:"",onChange:e.handleInputChange,className:n("TagControl-input"),result:d,onResultChange:e.handleChange,itemRender:e.renderItem,clearable:l,maxTagCount:k,overflowTagPopover:q,popOverContainer:v||T.getModalContainer,allowInput:!g||g&&!(y!=null&&y.length),mobileUI:g,testIdBuilder:x==null?void 0:x.getChild("resule-box")}),children:p?m(se,{loadingConfig:H,size:"sm"}):void 0}),F!==!1?g?m(oe,{className:n("Tag-popup"),container:g?T==null?void 0:T.getModalContainer:v||T.getModalContainer,isShow:E&&!!P.length,showConfirm:!0,onConfirm:e.onConfirm,onHide:e.close,children:A("div",{children:[m(D,{selectedOptions:d,mobileUI:g,options:P.concat(e.state.cacheOptions),itemRender:e.renderItem,highlightIndex:B,getItemProps:function(f){var O=f.item,N=f.index;return R({},S({index:N,item:O,className:n("ListMenu-item",{"is-active":~(e.state.selectedOptions.map(function(G){return G[w]})||[]).indexOf(O[w])})}))}}),g&&!e.isReachMaxFromState()?m("div",{className:n("ListMenu-add-wrap"),children:m(L,{placeholder:M("placeholder.enter")+"...",allowInput:!0,value:e.state.inputValue,mobileUI:g,clearable:!0,maxTagCount:k,onChange:function(f){e.setState({inputValue:f})},onBlur:e.addSelection})}):null]})}):m(le,{container:v||e.getParent,target:e.getTarget,placement:"auto",show:E&&!!P.length,children:m(ue,{overlay:!0,className:n("TagControl-popover"),onHide:e.close,children:m(D,{options:P,itemRender:e.renderItem,highlightIndex:B,testIdBuilder:x==null?void 0:x.getChild("options"),getItemProps:function(f){var O=f.item,N=f.index;return R({},S({index:N,item:O,disabled:j||O.disabled,className:n("ListMenu-item",{"is-disabled":j})}))}})})}):A("div",{className:n("TagControl-sug"),children:[U?m("div",{className:n("TagControl-sugTip"),children:M(U)}):null,y.map(function(f,O){return m("div",{className:n("TagControl-sugItem",{"is-disabled":f.disabled||r||j}),onClick:e.addItem.bind(e,f),children:f.label},O)})]})]})}})},s.defaultProps={resetValue:"",labelField:"label",valueField:"value",multiple:!0,placeholder:"Tag.placeholder",optionsTip:"Tag.tip",separator:"-"},c([h,o("design:type",Function),o("design:paramtypes",[String,Object]),o("design:returntype",Promise)],s.prototype,"dispatchEvent",null),c([h,o("design:type",Function),o("design:paramtypes",[String,Object,Array]),o("design:returntype",void 0)],s.prototype,"getValue",null),c([h,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],s.prototype,"addSelection",null),c([h,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],s.prototype,"onConfirm",null),c([h,o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],s.prototype,"handleFocus",null),c([h,o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],s.prototype,"handleBlur",null),c([h,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],s.prototype,"close",null),c([h,o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",void 0)],s.prototype,"handleInputChange",null),c([h,o("design:type",Function),o("design:paramtypes",[Array]),o("design:returntype",Promise)],s.prototype,"handleChange",null),c([h,o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Object)],s.prototype,"renderItem",null),c([h,o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],s.prototype,"handleKeyDown",null),c([h,o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",void 0)],s.prototype,"handleOptionChange",null),c([h,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],s.prototype,"getTarget",null),c([h,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],s.prototype,"getParent",null),c([h,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],s.prototype,"isReachMax",null),c([h,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],s.prototype,"isReachMaxFromState",null),c([de(),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],s.prototype,"render",null),s}(z.PureComponent),me=function(V){K(s,V);function s(){return V!==null&&V.apply(this,arguments)||this}return s=c([pe({type:"input-tag"})],s),s}(ve);export{me as TagControlRenderer,ve as default};

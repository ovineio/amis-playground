import{a as ee,R as G,b2 as Ue,bT as Me,a2 as ze,aq as qe,ae as J,bL as We,br as K,d as C,b4 as Q,h as k,k as D,E as w,j as x,bU as $e,X as B,an as Xe,i as Ye,r as Ge,bV as Je,bz as H,U as Ke,l as P,F as Z,S as Qe,V as Ze,e as m,p as _,q as s,a_ as et,b9 as tt,bW as it,Y as rt,w as at}from"./index-26b02238.js";var nt=function(I){ee(n,I);function n(e){var t=this,i;return t=I.call(this,e)||this,t.rootRef=G.createRef(),t.state={keyword:"",filteredOptions:(i=t.props.options)!==null&&i!==void 0?i:[],allowSearch:!1,virtualListHeight:0,othersHeight:0},t.handleSearch=Ue(t.handleSearch.bind(t),250,{trailing:!0,leading:!1}),t}return n.prototype.componentDidMount=function(){var e=this,t;this.props.heightAuto&&(this.initOthersHeight(),this.handleVirtualListHeight(),this.unSensor=Me((t=this.rootRef.current)===null||t===void 0?void 0:t.parentElement,function(){e.handleVirtualListHeight()},!1,"height"))},n.prototype.componentDidUpdate=function(e,t){var i=this.props,r=this.state,a=this.state.keyword;if(e.options!==i.options||e.searchable!==i.searchable){var l=i.options,o=i.searchable;this.setState({filteredOptions:o&&a?this.filterOptions(l,a):l})}ze(["label","searchable","creatable","hideRoot","themeCss","wrapperCustomStyle","heightAuto"],e,i)&&i.heightAuto&&this.initOthersHeight(),t.othersHeight!==r.othersHeight&&i.heightAuto&&this.handleVirtualListHeight()},n.prototype.componentWillUnmount=function(){this.unSensor&&(this.unSensor(),delete this.unSensor)},n.prototype.initOthersHeight=function(){var e=this,t,i,r=this.rootRef.current,a=(t=this.rootRef.current)===null||t===void 0?void 0:t.parentElement,l=this.treeRef.virtualListRef.current,o=(i=this.treeRef.virtualListRef.current)===null||i===void 0?void 0:i.parentElement;if(!(!a||!o||!l||!r)){var u=function(p,c){return Array.from(p.children).filter(function(h){return h!==c}).reduce(function(h,v){return h+v.offsetHeight+e.getElementVerticalMargin(v)},0)},d=u(a,r)+this.getElementVerticalMargin(r)+u(o,l)+r.offsetHeight-o.offsetHeight;this.setState({othersHeight:d})}},n.prototype.handleVirtualListHeight=function(){var e,t=this.state.othersHeight,i=(e=this.rootRef.current)===null||e===void 0?void 0:e.parentElement;if(i){var r=i.offsetHeight-t;this.setState({virtualListHeight:r>0?r:0})}},n.prototype.getElementVerticalMargin=function(e){var t=window.getComputedStyle(e,null);return parseInt(t.marginTop||"0")+parseInt(t.marginBottom||"0")},n.prototype.reload=function(){var e=this.props.reloadOptions;e&&e()},n.prototype.doAction=function(e,t,i){var r,a,l,o,u,d,p,c,h,v,g,F=e==null?void 0:e.actionType,y=this.props,A=y.resetValue,f=y.onChange,b=y.formStore,O=y.store,T=y.name;if(F==="clear")f==null||f("");else if(F==="reset"){var S=(a=qe((r=b==null?void 0:b.pristine)!==null&&r!==void 0?r:O==null?void 0:O.pristine,T))!==null&&a!==void 0?a:A;f==null||f(S??"")}else e.actionType==="expand"?this.treeRef.syncUnFolded(this.props,(l=e.args)===null||l===void 0?void 0:l.openLevel):e.actionType==="collapse"?this.treeRef.syncUnFolded(this.props,((o=e.args)===null||o===void 0?void 0:o.closeLevel)||0):e.actionType==="add"?this.addItemFromAction((u=e.args)===null||u===void 0?void 0:u.item,(d=e.args)===null||d===void 0?void 0:d.parentValue):e.actionType==="edit"?this.editItemFromAction((p=e.args)===null||p===void 0?void 0:p.item,(c=e.args)===null||c===void 0?void 0:c.originValue):e.actionType==="delete"?this.deleteItemFromAction((h=e.args)===null||h===void 0?void 0:h.value):e.actionType==="reload"?this.reload():F==="search"&&(this.setState({allowSearch:!!(!((v=e.args)===null||v===void 0)&&v.keyword)}),this.handleSearch((g=e.args)===null||g===void 0?void 0:g.keyword))},n.prototype.resolveOption=function(e,t){var i=this;return J(e,function(r){var a=i.props.valueField||"value",l=K(r,a)?r[a]:"";return l===t})},n.prototype.addItemFromAction=function(e,t){var i=this.props,r=i.onAdd,a=i.options,l=i.valueField,o=We(a,function(u){var d=l||"value",p=K(u,d)?u[d]:"";return p===t})||[];r&&r(o.concat(0),e,!0)},n.prototype.editItemFromAction=function(e,t){var i=this.props,r=i.onEdit,a=i.options,l=this.resolveOption(a,t);r&&l&&r(C(C({},e),{originValue:t}),l,!0)},n.prototype.deleteItemFromAction=function(e){var t=this.props,i=t.onDelete,r=t.options,a=this.resolveOption(r,e);i&&a&&i(a)},n.prototype.filterOptions=function(e,t){var i=this,r=this.props,a=r.labelField,l=r.valueField;return e.map(function(o){if(o=C({},o),o.visible=!!Q([o],t,{keys:[a||"label",l||"value"],threshold:Q.rankings.CONTAINS}).length,!o.visible&&o.children){o.children=i.filterOptions(o.children,t);var u=o.children.filter(function(d){return d.visible}).length;o.visible=!!u}return o.visible&&(o.collapsed=!1),o})},n.prototype.handleChange=function(e){return k(this,void 0,void 0,function(){var t,i,r,a,l,o,u,d,p,c,h,v,g,F,y,A,f,b;return D(this,function(O){switch(O.label){case 0:return t=this.props,i=t.onChange,r=t.searchable,a=t.options,l=t.dispatchEvent,o=t.multiple,u=t.delimiter,d=t.valueField,p=t.selectedOptions,c=t.joinValues,h=t.extractValue,v=this.state,g=v.filteredOptions,F=v.allowSearch,y=r||F?g:a,A=it(e,{multiple:o,delimiter:u,valueField:d,options:g}),f=o?null:A[0],o&&(r||F)&&p.length&&(p.forEach(function(T){var S=J(g,function(N){return N[d||"value"]===T[d||"value"]});S||A.push(T)}),e=A.map(function(T){return h||c?T[d||"value"]:T}),c&&(e=e.join(u||","))),[4,l("change",rt(this.props,{value:e,item:f,items:y,selectedItems:A}))];case 1:return b=O.sent(),b!=null&&b.prevented?[2]:(i&&i(e),[2])}})})},n.prototype.handleNodeClick=function(e){return k(this,void 0,void 0,function(){var t,i,r,a;return D(this,function(l){switch(l.label){case 0:return t=this.props,i=t.dispatchEvent,r=t.data,[4,i("itemClick",w(r,{item:e}))];case 1:return a=l.sent(),a!=null&&a.prevented?[2]:[2]}})})},n.prototype.handleSearch=function(e){return k(this,void 0,void 0,function(){var t,i,r,a,l,o,u,d,p,c;return D(this,function(h){switch(h.label){case 0:if(t=this.props,i=t.searchApi,r=t.options,a=t.env,l=t.data,o=t.translate,u=[],!at(i))return[3,5];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,a.fetcher(i,w(l,{term:e}))];case 2:if(d=h.sent(),!d.ok)throw new Error(o(d.msg||"networkError"));if(p=d.data.options||d.data.items||d.data,!Array.isArray(p))throw new Error(o("Tree.invalidArray"));return u=p,[3,4];case 3:return c=h.sent(),a.isCancel(c)||!i.silent&&a.notify("error",c.message),[3,4];case 4:return[3,6];case 5:e&&(u=this.filterOptions(r,e)),h.label=6;case 6:return this.setState({keyword:e,filteredOptions:e?u:r}),[2]}})})},n.prototype.domRef=function(e){this.treeRef=e},n.prototype.validate=function(){var e=this.props,t=e.value,i=e.minLength,r=e.maxLength,a=e.delimiter,l=Array.isArray(t)?t:(t?String(t):"").split(a||",");if(i&&l.length<i)return"已选择数量低于设定的最小个数".concat(i,"，请选择更多的选项。");if(r&&l.length>r)return"已选择数量超出设定的最大个数".concat(r,"，请取消选择超出的选项。")},n.prototype.renderOptionItem=function(e,t){var i=this.props,r=i.menuTpl,a=i.render,l=i.data;return a("option/".concat(t.index),r,{data:w(w(l,C({},t)),e)})},n.prototype.renderItemActions=function(e,t){var i=this.props,r=i.itemActions,a=i.data,l=i.render;return l("action/".concat(t.index),r||"",{data:w(w(a,C({},t)),e)})},n.prototype.renderSearch=function(){var e=this.props,t=e.classPrefix,i=e.searchConfig,r=e.mobileUI,a=e.testIdBuilder;return x($e,{...C({className:B("".concat(t,"TreeControl-searchbox"),i==null?void 0:i.className,{"is-sticky":i==null?void 0:i.sticky}),mini:!1,clearable:!0},Xe(i,"className","sticky"),{onSearch:this.handleSearch,mobileUI:r,testIdBuilder:a==null?void 0:a.getChild("search")})})},n.prototype.render=function(){var e=this.props,t=e.className,i=e.treeContainerClassName,r=e.classPrefix,a=e.value,l=e.enableNodePath,o=e.pathSeparator,u=o===void 0?"/":o,d=e.disabled,p=e.joinValues,c=e.extractValue,h=e.delimiter,v=e.placeholder,g=e.options,F=e.multiple,y=e.valueField,A=e.initiallyOpen,f=e.unfoldedLevel,b=e.withChildren,O=e.onlyChildren,T=e.onlyLeaf,S=e.loading,N=e.hideRoot,te=e.rootLabel,ie=e.autoCheckChildren,re=e.autoCancelParent,ae=e.cascade,ne=e.rootValue,oe=e.showIcon,le=e.showRadio,se=e.showOutline,de=e.onAdd,ue=e.creatable,he=e.createTip,pe=e.addControls,ce=e.onEdit,ve=e.editable,fe=e.editTip,me=e.editControls,ge=e.removable,ye=e.removeTip,be=e.onDelete,Ce=e.rootCreatable,Fe=e.rootCreateTip,Ae=e.labelField,Te=e.iconField,_e=e.deferField,Oe=e.nodePath,Se=e.deferLoad,Ie=e.expandTreeOptions,U=e.translate,Ee=e.data,we=e.virtualThreshold,M=e.itemHeight,Le=e.loadingConfig,Re=e.menuTpl,Ve=e.enableDefaultIcon,L=e.searchable,z=e.searchConfig,j=z===void 0?{}:z,xe=e.heightAuto,He=e.mobileUI,E=e.testIdBuilder,Ne=e.nodeBehavior,je=e.itemActions,q=e.id,ke=e.wrapperCustomStyle,W=e.themeCss,De=e.env,R=this.props.highlightTxt,V=this.state,Be=V.filteredOptions,Pe=V.keyword,$=V.allowSearch,X=V.virtualListHeight;Ye(R)&&(R=Ge(R,Ee));var Y=x(Je,{classPrefix:r,onRef:this.domRef,labelField:Ae,valueField:y,iconField:Te,deferField:_e,disabled:d,onChange:this.handleChange,onHandleNodeClick:this.handleNodeClick,joinValues:p,extractValue:c,delimiter:h,placeholder:U(v),options:L||$?Be:g,highlightTxt:L||$?Pe:R,multiple:F,initiallyOpen:A,unfoldedLevel:f,withChildren:b,onlyChildren:O,onlyLeaf:T,hideRoot:N,rootLabel:U(te),rootValue:ne,showIcon:oe,showRadio:le,showOutline:se,autoCheckChildren:ie,autoCancelParent:re,cascade:ae,foldedField:"collapsed",value:a||"",nodePath:Oe,enableNodePath:l,pathSeparator:u,selfDisabledAffectChildren:!1,onAdd:de,creatable:ue,createTip:he,rootCreatable:Ce,rootCreateTip:Fe,onEdit:ce,editable:ve,editTip:fe,removable:ge,removeTip:ye,onDelete:be,bultinCUD:!pe&&!me,onDeferLoad:Se,onExpandTree:Ie,virtualThreshold:we,virtualHeight:H(X)>=0?H(X):void 0,itemHeight:H(M)>0?H(M):void 0,itemRender:Re?this.renderOptionItem:void 0,enableDefaultIcon:Ve,mobileUI:He,nodeBehavior:Ne,itemActionsRender:je?this.renderItemActions:void 0,actionClassName:B(Ke(C(C({},this.props),{name:"actionControlClassName",id:q,themeCss:W}))),testIdBuilder:E==null?void 0:E.getChild("tree")});return P(Z,{children:[P("div",{...C({ref:this.rootRef,className:B("".concat(r,"TreeControl"),t,i,{"is-sticky":L&&(j==null?void 0:j.sticky),"h-auto":xe})},E==null?void 0:E.getChild("control").getTestId()),children:[x(Qe,{size:"sm",show:S,loadingConfig:Le},"info"),S?null:L?P(Z,{children:[this.renderSearch(),Y]}):Y]}),x(Ze,{...C({},this.props,{config:{wrapperCustomStyle:ke,id:q,themeCss:W,classNames:[{key:"actionControlClassName"}]},env:De})})]})},n.defaultProps={placeholder:"placeholder.noData",multiple:!1,rootLabel:"Tree.root",rootValue:"",showIcon:!0,enableNodePath:!1,pathSeparator:"/"},m([_,s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],n.prototype,"addItemFromAction",null),m([_,s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],n.prototype,"editItemFromAction",null),m([_,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],n.prototype,"deleteItemFromAction",null),m([_,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],n.prototype,"handleChange",null),m([_,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],n.prototype,"handleNodeClick",null),m([_,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],n.prototype,"domRef",null),m([_,s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],n.prototype,"renderOptionItem",null),m([_,s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],n.prototype,"renderItemActions",null),m([_,s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",void 0)],n.prototype,"renderSearch",null),m([et(),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",void 0)],n.prototype,"render",null),n}(G.Component),lt=function(I){ee(n,I);function n(){return I!==null&&I.apply(this,arguments)||this}return n=m([tt({type:"input-tree"})],n),n}(nt);export{lt as TreeControlRenderer,nt as default};

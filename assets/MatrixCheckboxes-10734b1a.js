import{a as R,bZ as N,b_ as O,aq as T,h as _,k as A,j as g,G as j,l as y,aN as x,S as B,e as E,a_ as q,q as M,R as F,d as m,C as H,ba as V,w as z,Y as L}from"./index-12050af9.js";var U=function(b){R(o,b);function o(t){var e=b.call(this,t)||this;return e.mounted=!1,e.toDispose=[],e.state={columns:t.columns||[],rows:t.rows||[],loading:!1},e.toggleItem=e.toggleItem.bind(e),e.reload=e.reload.bind(e),e.initOptions=e.initOptions.bind(e),e.mounted=!0,e}return o.prototype.componentDidMount=function(){var t=this.props,e=t.formInited,n=t.addHook,r=t.formItem;r&&this.toDispose.push(e||!n?r.addInitHook(this.initOptions):n(this.initOptions,"init"))},o.prototype.componentDidUpdate=function(t){var e=this.props;if(t.columns!==e.columns||t.rows!==e.rows)this.setState({columns:e.columns||[],rows:e.rows||[]});else if(e.formInited&&(e.source!==t.source||t.data!==e.data)){var n=N(t.source,t.data,{ignoreData:!0}),r=N(e.source,e.data,{ignoreData:!0});n.url!==r.url&&O(r.url)&&this.reload()}},o.prototype.componentWillUnmount=function(){this.mounted=!1,this.toDispose.forEach(function(t){return t()}),this.toDispose=[]},o.prototype.doAction=function(t,e,n){var r,i,a=this.props,c=a.resetValue,f=a.onChange,d=a.formStore,v=a.store,s=a.name,l=t==null?void 0:t.actionType;if(l==="clear")f==null||f("");else if(l==="reset"){var p=(i=T((r=d==null?void 0:d.pristine)!==null&&r!==void 0?r:v==null?void 0:v.pristine,s))!==null&&i!==void 0?i:c;f==null||f(p??"")}},o.prototype.initOptions=function(t){return _(this,void 0,void 0,function(){var e,n,r;return A(this,function(i){switch(i.label){case 0:return[4,this.reload()];case 1:return i.sent(),e=this.props,n=e.formItem,r=e.name,n?(n.value&&V(t,r,n.value),[2]):[2]}})})},o.prototype.reload=function(){return _(this,void 0,void 0,function(){var t,e,n,r,i,a,c=this;return A(this,function(f){switch(f.label){case 0:if(t=this.props,e=t.source,n=t.data,r=t.env,i=t.onChange,a=t.translate,!z(e,n)||this.state.loading)return[2];if(!r||!r.fetcher)throw new Error("fetcher is required");return[4,new Promise(function(d,v){if(!c.mounted)return d();c.setState({loading:!0},function(){if(!c.mounted)return d();r.fetcher(e,n).then(function(s){if(!s.ok)throw new Error(s.msg||a("fetchFailed"));if(!c.mounted)return d();c.setState({loading:!1,rows:s.data.rows||[],columns:s.data.columns||[]},function(){e&&e.replaceData;var l=s.data.value;l&&(l=e.replaceData?l:$(l,c.state.columns,c.state.rows),i(l)),d()})}).catch(function(s){return c.setState({error:s,loading:!1},function(){return d()})})})})];case 1:return[2,f.sent()]}})})},o.prototype.toggleItem=function(t,e,n){return _(this,void 0,void 0,function(){var r,i,a,c,f,d,v,s,u,p,l,p,l,p,u,C,k;return A(this,function(h){switch(h.label){case 0:if(r=this.state,i=r.columns,a=r.rows,c=this.props,f=c.multiple,d=c.singleSelectMode,v=c.dispatchEvent,c.data,s=this.props.value||S(i,a),f)s[e][n]=m(m({},s[e][n]),{checked:t});else if(d==="row")for(u=0,p=i.length;u<p;u++)s[u][n]=m(m({},s[u][n]),{checked:e===u?t:!t});else if(d==="column")for(l=0,p=a.length;l<p;l++)s[e][l]=m(m({},s[e][l]),{checked:n===l?t:!t});else for(l=0,p=a.length;l<p;l++)for(u=0,C=i.length;u<C;u++)s[u][l]=m(m({},s[u][l]),{checked:e===u&&n===l?t:!t});return[4,v("change",L(this.props,{value:s.concat()}))];case 1:return k=h.sent(),k!=null&&k.prevented?[2]:(this.props.onChange(s.concat()),[2])}})})},o.prototype.isColumChecked=function(t,e){var n=t[e];return n?n.some(function(r){return r&&r.checked}):!1},o.prototype.isColumnPartialChecked=function(t,e){var n=t[e];if(!n||n.length==1)return!1;var r=n[0].checked;return n.some(function(i){return i.checked!==r})&&!n.every(function(i){return i.checked===r})},o.prototype.toggleColumnCheckAll=function(t,e,n){return _(this,void 0,void 0,function(){var r,i;return A(this,function(a){switch(a.label){case 0:r=e[n],i=0,a.label=1;case 1:return i<r.length?[4,this.toggleItem(t,n,i)]:[3,4];case 2:a.sent(),a.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},o.prototype.isRowChecked=function(t,e){return t&&t.some(function(n){return n[e]&&n[e].checked})},o.prototype.isRowPartialChecked=function(t,e){if(!t||t.length==1)return!1;var n=t[0][e].checked;return t.some(function(r){return n!==r[e].checked})&&!t.every(function(r){return r.checked})},o.prototype.toggleRowCheckAll=function(t,e,n){return _(this,void 0,void 0,function(){var r;return A(this,function(i){switch(i.label){case 0:r=0,i.label=1;case 1:return r<e.length?[4,this.toggleItem(t,r,n)]:[3,4];case 2:i.sent(),i.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},o.prototype.renderInput=function(t){var e=this;t===void 0&&(t=!1);var n=this.state,r=n.columns,i=n.rows,a=this.props,c=a.rowLabel,f=a.disabled,d=a.classnames,v=a.multiple,s=a.textAlign,l=a.xCheckAll,p=a.yCheckAll,u=a.testIdBuilder,C=this.props.value||S(r,i);return g("div",{className:d("Table m-b-none",{"is-mobile":j()}),children:g("div",{className:d("Table-content"),children:y("table",{className:d("Table-table"),children:[g("thead",{children:y("tr",{children:[g("th",{children:c}),r.map(function(k,h){return y("th",{className:"text-"+(s||v?"left":"center"),children:[v&&p?g(x,{type:"checkbox",disabled:t||f,checked:e.isColumChecked(C,h),partial:e.isColumnPartialChecked(C,h),onChange:function(I){return e.toggleColumnCheckAll(I,C,h)}}):null,k.label]},h)})]})}),g("tbody",{children:i.map(function(k,h){return y("tr",{children:[y("td",{children:[v&&l?g(x,{type:"checkbox",disabled:t||f,checked:e.isRowChecked(C,h),partial:e.isRowPartialChecked(C,h),onChange:function(I){return e.toggleRowCheckAll(I,C,h)},testIdBuilder:u==null?void 0:u.getChild(h)}):null,k.label,k.description||k.desc?g("span",{className:"m-l-xs text-muted text-xs",children:k.description||k.desc}):null]}),r.map(function(I,w){return g("td",{className:"text-"+(s||v?"left":"center"),children:g(x,{type:v?"checkbox":"radio",disabled:t||f,checked:!!(C[w]&&C[w][h]&&C[w][h].checked),onChange:function(D){return e.toggleItem(D,w,h)},testIdBuilder:u==null?void 0:u.getChild("".concat(w,"-").concat(h))})},w)})]},h)})})]})})})},o.prototype.renderStatic=function(t){t===void 0&&(t="-");var e=this.props,n=e.className;e.render;var r=e.classnames,i=this.state.error;return g("div",{className:r("MatrixControl",n||""),children:i?t:this.renderInput(!0)},"input")},o.prototype.render=function(){var t=this.props,e=t.className;t.render;var n=t.classnames,r=t.loadingConfig,i=this.state,a=i.error,c=i.loading;return y("div",{className:n("MatrixControl",e||""),children:[a?g("div",{className:n("MatrixControl-error Alert Alert--danger"),children:String(a)}):this.renderInput(),g(B,{size:"lg",overlay:!0,show:c,loadingConfig:r},"info")]},"input")},o.defaultProps={columns:[],rows:[],multiple:!0,singleSelectMode:"column"},E([q(),M("design:type",Function),M("design:paramtypes",[]),M("design:returntype",void 0)],o.prototype,"render",null),o}(F.Component);function S(b,o){return Array.isArray(b)||(b=[]),Array.isArray(o)||(o=[]),b.map(function(t){return o.map(function(e){return m(m(m({},e),t),{checked:!1})})})}function $(b,o,t){return b.map(function(e,n){return e.map(function(r,i){return m(m(m({},o[n]),t[i]),r)})})}var P=function(b){R(o,b);function o(){return b!==null&&b.apply(this,arguments)||this}return o=E([H({type:"matrix-checkboxes",strictMode:!1,sizeMutable:!1})],o),o}(U);export{P as MatrixRenderer,U as default};

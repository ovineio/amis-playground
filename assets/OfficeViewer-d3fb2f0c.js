import{a as S,R as g,u as V,n as O,r as E,E as W,h as u,k as h,_ as x,l as b,j as p,S as F,s as R,e as A,f as T,q as N,d as v}from"./index-26b02238.js";var j=function(f){S(s,f);function s(e){var t=f.call(this,e)||this;return t.rootElement=g.createRef(),t.state={loading:!1},t}return s.prototype.componentDidMount=function(){var e;!((e=this.rootElement)===null||e===void 0)&&e.current&&this.renderWord()},s.prototype.componentDidUpdate=function(e){var t=this,r,n;if(!this.state.loading){var i=this.props;V(e.src,i.src,e.data,i.data)&&this.fetchWord().then(function(){t.renderWord()}),i.name&&e.data[i.name]!==i.data[i.name]&&this.renderWord(),(JSON.stringify(e.wordOptions)!==JSON.stringify(i.wordOptions)||e.display!==i.display)&&this.renderWord(),!((r=i.wordOptions)===null||r===void 0)&&r.enableVar&&(i.trackExpression&&O(i.trackExpression,i.data)!==O(e.trackExpression,e.data)?this.renderWord():(n=this.office)===null||n===void 0||n.updateVariable())}},s.prototype.doAction=function(e,t,r,n){var i,l,a=e==null?void 0:e.actionType;a==="saveAs"&&((i=this.office)===null||i===void 0||i.download((n==null?void 0:n.name)||this.fileName)),a==="print"&&((l=this.office)===null||l===void 0||l.print())},s.prototype.evalVar=function(e,t){var r=this.props.data;return E("${"+e+"}",W(t,r),"| raw")},s.prototype.renderWord=function(){return u(this,void 0,void 0,function(){var e,t,r;return h(this,function(n){switch(n.label){case 0:return e=this.props,t=e.src,r=e.name,t?this.document?[3,2]:[4,this.fetchWord()]:[3,4];case 1:n.sent(),n.label=2;case 2:return[4,this.renderRemoteWord()];case 3:return n.sent(),[3,5];case 4:r&&this.renderFormFile(),n.label=5;case 5:return[2]}})})},s.prototype.fetchWord=function(){var e;return u(this,void 0,void 0,function(){var t,r,n,i,l,a,o,d;return h(this,function(c){switch(c.label){case 0:if(t=this.props,r=t.env,n=t.src,i=t.data,l=t.translate,o=n?E(n,i,"| raw"):void 0,typeof o=="string"?(a=o,this.fileName=a.split("/").pop()):typeof o=="object"&&typeof o.value=="string"&&(a=o.value,this.fileName=o.name||a.split("/").pop()),!a)return console.warn("file src is empty"),[2];this.finalSrc=a,this.setState({loading:!0}),c.label=1;case 1:return c.trys.push([1,3,4,5]),[4,r.fetcher(a,i,{responseType:"arraybuffer"})];case 2:return d=c.sent(),this.document=d.data,[3,5];case 3:return c.sent(),!((e=this.rootElement)===null||e===void 0)&&e.current&&(this.rootElement.current.innerHTML=l("loadingFailed")+" url:"+a),[3,5];case 4:return this.setState({loading:!1}),[7];case 5:return[2]}})})},s.prototype.initOffice=function(e,t){return u(this,void 0,void 0,function(){var r,n,i,l,a,o;return h(this,function(d){switch(d.label){case 0:return r=this.props,n=r.wordOptions,i=r.excelOptions,r.env,r.src,l=r.data,r.translate,a=e.createOfficeViewer,[4,a(t||this.document,{},this.finalSrc)];case 1:return o=d.sent(),o instanceof e.Word?(o.updateOptions(v(v({},n),{data:l,evalVar:this.evalVar.bind(this)})),[3,4]):[3,2];case 2:return o instanceof e.Excel?(o.updateOptions(v(v({},i),{data:l,evalVar:this.evalVar.bind(this)})),[4,o.loadExcel()]):[3,4];case 3:d.sent(),d.label=4;case 4:return[2,o]}})})},s.prototype.renderRemoteWord=function(){return u(this,void 0,void 0,function(){var e,t,r=this;return h(this,function(n){return e=this.props,e.wordOptions,e.excelOptions,e.env,e.src,e.data,t=e.display,e.translate,this.document?(x(()=>import("./index-5f72423a.js"),["./index-5f72423a.js","./index-26b02238.js","./index-3250bc9b.css"],import.meta.url).then(function(i){return u(r,void 0,void 0,function(){var l,a,o;return h(this,function(d){switch(d.label){case 0:return[4,this.initOffice(i)];case 1:return l=d.sent(),t!==!1?l.render((a=this.rootElement)===null||a===void 0?void 0:a.current):t===!1&&(!((o=this.rootElement)===null||o===void 0)&&o.current)&&(this.rootElement.current.innerHTML=""),this.office=l,this.setState({loading:!1}),[2]}})})}),[2]):[2]})})},s.prototype.renderFormFile=function(){var e=this;this.setState({loading:!0});var t=this.props;t.wordOptions;var r=t.name,n=t.data,i=t.display,l=n[r];if(l instanceof File){var a=new FileReader;a.onload=function(o){var d=a.result;x(()=>import("./index-5f72423a.js"),["./index-5f72423a.js","./index-26b02238.js","./index-3250bc9b.css"],import.meta.url).then(function(c){return u(e,void 0,void 0,function(){var m,y,_;return h(this,function(w){switch(w.label){case 0:return[4,this.initOffice(c,d)];case 1:return m=w.sent(),i!==!1?m.render((y=this.rootElement)===null||y===void 0?void 0:y.current):i===!1&&(!((_=this.rootElement)===null||_===void 0)&&_.current)&&(this.rootElement.current.innerHTML=""),this.office=m,this.setState({loading:!1}),[2]}})})})},a.readAsArrayBuffer(l)}else this.setState({loading:!1})},s.prototype.render=function(){var e=this.props,t=e.classnames;e.translate;var r=e.className,n=e.loading,i=n===void 0?!1:n,l=e.src,a=e.name,o=e.display,d=e.loadingConfig;return b("div",{children:[o!==!1&&!l&&!a&&b("svg",{width:"100%",height:"100",xmlns:"http://www.w3.org/2000/svg",children:[p("rect",{x:"0",y:"0",width:"100%",height:"100",style:{fill:"#F7F7F9"}}),p("text",{x:"50%",y:"50%",fontSize:"18",textAnchor:"middle",alignmentBaseline:"middle",fontFamily:"monospace, sans-serif",fill:"#555555",children:"office viewer"})]}),p("div",{ref:this.rootElement,className:t("office-viewer",r)}),p(F,{overlay:!0,show:i&&this.state.loading,loadingConfig:d},"info")]})},s}(g.Component),D=function(f){S(s,f);function s(e,t){var r=f.call(this,e)||this,n=t;return n.registerComponent(r),r}return s.prototype.componentWillUnmount=function(){var e;(e=f.prototype.componentWillUnmount)===null||e===void 0||e.call(this);var t=this.context;t.unRegisterComponent(this)},s.contextType=R,s=A([T({type:"office-viewer"}),N("design:paramtypes",[Object,Object])],s),s}(j);export{D as OfficeViewerRenderer,j as default};

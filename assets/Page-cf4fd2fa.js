import{a as F,cV as U,h as M,k as R,u as L,w as T,a4 as I,E as Q,as as E,aj as _,d as h,ak as V,l as S,U as D,j as A,S as J,A as H,aL as X,aB as $,V as G,e as P,p as O,q as y,R as K,s as Y,f as Z,cW as q,au as ee,n as te,ac as ae,J as ne}from"./index-26b02238.js";var se=function(g){F(o,g);function o(e){var t=g.call(this,e)||this;return U(t,["handleAction","handleChange","handleBulkChange","handleQuery","handleDialogConfirm","handleDialogClose","handleDrawerConfirm","handleDrawerClose","handleClick","reload","silentReload","initInterval"]),t.style=document.createElement("style"),t.style.setAttribute("data-page",""),document.getElementsByTagName("head")[0].appendChild(t.style),t.updateStyle(),t.varStyle=document.createElement("style"),t.varStyle.setAttribute("data-vars",""),document.getElementsByTagName("head")[0].appendChild(t.varStyle),t.updateVarStyle(),t}return o.prototype.updateStyle=function(){this.props.css||this.props.mobileCSS?this.style.innerHTML=`
      `.concat(this.buildCSS(this.props.css),`

      @media (max-width: 768px) {
        `).concat(this.buildCSS(this.props.mobileCSS),`
      }
      `):this.style.innerHTML=""},o.prototype.buildCSS=function(e){if(!e)return"";var t="";for(var a in e){var n=e[a],s="";for(var i in n){var d="",l=n[i];if(typeof l=="string")s+="  ".concat(i,": ").concat(l,`;
`);else{for(var r in l)d+=" ".concat(r,":").concat(l[r],";");s+="  ".concat(i," {").concat(d,`}
`)}}t+=`
      `.concat(a,` {
        `).concat(s,`
      }
      `)}return t},o.prototype.updateVarStyle=function(){var e=this.props.cssVars,t="";if(e){for(var a in e)if(a.startsWith("--")){if(a.indexOf(":")!==-1)continue;var n=e[a];if(typeof n=="string"&&(n.indexOf("expression(")!==-1||n.indexOf(";")!==-1))continue;t+="".concat(a,": ").concat(n,`; 
`)}this.varStyle.innerHTML=`
      :root {
        `.concat(t,`
      }
      `)}},o.prototype.componentDidMount=function(){return M(this,void 0,void 0,function(){var e,t,a,n,s,i,d,l,r,p;return R(this,function(u){switch(u.label){case 0:return e=this.props,t=e.initApi,a=e.initFetch,n=e.initFetchOn,s=e.store,i=e.messages,d=e.data,l=e.dispatchEvent,r=e.env,this.mounted=!0,[4,l("init",d,this)];case 1:return p=u.sent(),r!=null&&r.tracker&&r.tracker({eventType:"pageLoaded"},this.props),p!=null&&p.prevented||!ee(s)?[2]:(T(t,s.data,a,n)&&s.fetchInitData(t,s.data,{successMessage:i&&i.fetchSuccess,errorMessage:i&&i.fetchFailed}).then(this.initInterval),[2])}})})},o.prototype.componentDidUpdate=function(e){var t=this.props,a=t.store,n=t.initApi;if(t.initFetchOn&&t.initFetch&&!e.initFetch||t.initFetch!==!1&&L(e.initApi,n,e.data,t.data)){var s=t.messages;T(n,a.data)&&a.fetchData(n,a.data,{successMessage:s&&s.fetchSuccess,errorMessage:s&&s.fetchFailed}).then(this.initInterval)}(JSON.stringify(t.css)!==JSON.stringify(e.css)||JSON.stringify(t.mobileCSS)!==JSON.stringify(e.mobileCSS))&&this.updateStyle(),JSON.stringify(t.cssVars)!==JSON.stringify(e.cssVars)&&this.updateVarStyle(),I(e.defaultData,t.defaultData)&&a.reInitData(t.defaultData)},o.prototype.componentWillUnmount=function(){var e,t;this.mounted=!1,clearTimeout(this.timer),this.style&&((e=this.style.parentNode)===null||e===void 0||e.removeChild(this.style)),this.varStyle&&((t=this.varStyle.parentNode)===null||t===void 0||t.removeChild(this.varStyle))},o.prototype.reloadTarget=function(e,t){},o.prototype.handleAction=function(e,t,a,n,s){var i=this;n===void 0&&(n=!1);var d=this.props,l=d.env,r=d.store,p=d.messages,u=d.onAction;return t.actionType==="dialog"?(r.setCurrentAction(t,this.props.resolveDefinitions),new Promise(function(c){r.openDialog(a,void 0,function(f,v){var m;(m=t.callback)===null||m===void 0||m.call(t,f,v),c({confirmed:f,value:v})},s||i.context)})):t.actionType==="drawer"?(r.setCurrentAction(t,this.props.resolveDefinitions),new Promise(function(c){r.openDrawer(a,void 0,function(f,v){var m;(m=t.callback)===null||m===void 0||m.call(t,f,v),c({confirmed:f,value:v})},s)})):t.actionType==="ajax"?(r.setCurrentAction(t,this.props.resolveDefinitions),T(t.api,a)?r.saveRemote(t.api,a,{successMessage:t.messages&&t.messages.success||p&&p.saveSuccess,errorMessage:t.messages&&t.messages.failed||p&&p.saveSuccess}).then(function(){return M(i,void 0,void 0,function(){var c;return R(this,function(f){switch(f.label){case 0:return t.feedback&&ne(t.feedback,r.data)?[4,this.openFeedback(t.feedback,r.data)]:[3,2];case 1:f.sent(),f.label=2;case 2:return c=t.redirect&&te(t.redirect,r.data),c&&l.jumpTo(c,t,r.data),t.reload&&this.reloadTarget(ae(t.reload,r.data),r.data),[2]}})})}).catch(function(c){if(n||t.countDown)throw c}):void 0):u(e,t,a,n,s||this.context)},o.prototype.handleQuery=function(e){if(this.props.initApi){if(e!=null&&e.hasOwnProperty("orderBy")&&!L(this.props.initApi,this.props.initApi,this.props.store.data,Q(this.props.store.data,e)))return!1;this.receive(e);return}return this.props.onQuery?this.props.onQuery(e):!1},o.prototype.handleDialogConfirm=function(e,t){for(var a=[],n=2;n<arguments.length;n++)a[n-2]=arguments[n];var s=this.props.store;t.mergeData&&e.length===1&&e[0]&&s.updateData(e[0]);var i=s.action.dialog;i&&i.onConfirm&&i.onConfirm.apply(i,E([e,t],_(a),!1))===!1||s.closeDialog(!0,e)},o.prototype.handleDialogClose=function(e){e===void 0&&(e=!1);var t=this.props.store;t.closeDialog(e)},o.prototype.handleDrawerConfirm=function(e,t){for(var a=[],n=2;n<arguments.length;n++)a[n-2]=arguments[n];var s=this.props.store;t.mergeData&&e.length===1&&e[0]&&s.updateData(e[0]);var i=s.action.dialog;i&&i.onConfirm&&i.onConfirm.apply(i,E([e,t],_(a),!1))===!1||s.closeDrawer(!0,e)},o.prototype.handleDrawerClose=function(){var e=this.props.store;e.closeDrawer(!1)},o.prototype.handleClick=function(e){var t,a=e.target,n=this.props.env,s=a.tagName==="A"&&a.hasAttribute("data-link")?a.getAttribute("data-link"):(t=a.closest("a[data-link]"))===null||t===void 0?void 0:t.getAttribute("data-link");n&&s&&(n.jumpTo(s,void 0,this.props.data),e.preventDefault())},o.prototype.handleResizeMouseDown=function(e){var t=e.nativeEvent.which==3;t||(this.codeWrap=e.currentTarget.parentElement,document.addEventListener("mousemove",this.handleResizeMouseMove),document.addEventListener("mouseup",this.handleResizeMouseUp),this.startX=e.clientX,this.startWidth=this.codeWrap.offsetWidth)},o.prototype.handleResizeMouseMove=function(e){var t=this.props,a=t.asideMinWidth,n=a===void 0?160:a,s=t.asideMaxWidth,i=s===void 0?350:s,d=t.asidePosition,l=e.clientX-this.startX,r=d==="right"?this.startWidth-l:this.startWidth+l,p=Math.min(Math.max(r,n),i);this.codeWrap.style.cssText+="width: ".concat(p,"px")},o.prototype.handleResizeMouseUp=function(){document.removeEventListener("mousemove",this.handleResizeMouseMove),document.removeEventListener("mouseup",this.handleResizeMouseUp)},o.prototype.openFeedback=function(e,t){var a=this;return new Promise(function(n){var s=a.props.store;s.setCurrentAction({type:"button",actionType:"dialog",dialog:e},a.props.resolveDefinitions),s.openDialog(t,void 0,function(i){n(i)},a.context)})},o.prototype.reload=function(e,t,a,n,s){return M(this,void 0,void 0,function(){var i,d,l,r;return R(this,function(p){switch(p.label){case 0:return t?[2,this.receive(t,void 0,s)]:(i=this.props,d=i.store,l=i.initApi,clearTimeout(this.timer),T(l,d.data)?[4,d.fetchData(l,d.data,{silent:n})]:[3,2]);case 1:r=p.sent(),this.initInterval(r),p.label=2;case 2:return[2,d.data]}})})},o.prototype.receive=function(e,t,a){var n=this.props.store;n.updateData(e,void 0,a),this.reload()},o.prototype.silentReload=function(e,t){this.reload(t,void 0,void 0,!0)},o.prototype.initInterval=function(e){var t,a=this.props,n=a.interval,s=a.silentPolling,i=a.stopAutoRefreshWhen,d=a.data,l=a.dispatchEvent,r=a.store;return l("inited",Q(d,h(h({},e==null?void 0:e.data),{responseData:e!=null&&e.ok?(t=e==null?void 0:e.data)!==null&&t!==void 0?t:{}:e,responseStatus:(e==null?void 0:e.status)===void 0?r!=null&&r.error?1:0:e==null?void 0:e.status,responseMsg:(e==null?void 0:e.msg)||(r==null?void 0:r.msg)}))),e!=null&&e.ok&&n&&this.mounted&&(!i||!V(i,d))&&(this.timer=setTimeout(s?this.silentReload:this.reload,Math.max(n,1e3))),e},o.prototype.handleRefresh=function(){return M(this,void 0,void 0,function(){var e,t,a,n;return R(this,function(s){switch(s.label){case 0:return e=this.props,t=e.dispatchEvent,a=e.data,[4,t("pullRefresh",a)];case 1:return n=s.sent(),n!=null&&n.prevented?[2]:(this.reload(),[2])}})})},o.prototype.handleChange=function(e,t,a,n){var s=this.props,i=s.store,d=s.onChange;typeof t=="string"&&t&&i.changeValue(t,e,n),d==null||d.apply(null,arguments)},o.prototype.handleBulkChange=function(e){var t,a;(a=(t=this.props.store)===null||t===void 0?void 0:t.updateData)===null||a===void 0||a.call(t,e)},o.prototype.renderHeader=function(){var e=this.props,t=e.title,a=e.subTitle,n=e.remark,s=e.remarkPlacement,i=e.headerClassName,d=e.toolbarClassName,l=e.toolbar,r=e.render,p=e.store,u=e.initApi,c=e.popOverContainer,f=e.env,v=e.classnames,m=e.regions;e.translate;var k=e.id,C=e.themeCss,N={onAction:this.handleAction,onQuery:u?this.handleQuery:void 0,onChange:this.handleChange,onBulkChange:this.handleBulkChange,pageLoading:p.loading},w,b;return(Array.isArray(m)?~m.indexOf("header"):t||a)&&(w=S("div",{className:v("Page-header",i,D(h(h({},this.props),{name:"headerControlClassName",id:k,themeCss:C}))),children:[t?S("h2",{className:v("Page-title",D(h(h({},this.props),{name:"titleControlClassName",id:k,themeCss:C}))),children:[r("title",t,N),n?r("remark",{type:"remark",tooltip:n,placement:s||"bottom",container:c||f.getModalContainer}):null]}):null,a&&A("small",{className:v("Page-subTitle"),children:r("subTitle",a,N)})]})),(Array.isArray(m)?~m.indexOf("toolbar"):l)&&(b=A("div",{className:v("Page-toolbar",d,D(h(h({},this.props),{name:"toolbarControlClassName",id:k,themeCss:C}))),children:r("toolbar",l||"",N)})),w&&b?S("div",{className:v("Page-headerRow"),children:[w,b]}):w||b},o.prototype.renderContent=function(e){var t=this.props,a=t.store,n=t.body,s=t.bodyClassName,i=t.render,d=t.classnames,l=t.showErrorMsg,r=t.regions;t.translate;var p=t.loadingConfig;t.initApi;var u=t.id,c=t.env,f=t.themeCss;return A("div",{className:d("Page-content"),children:S("div",{className:d("Page-main"),children:[this.renderHeader(),S("div",{className:d("Page-body",s,D(h(h({},this.props),{name:"bodyControlClassName",id:u,themeCss:f}))),role:"page-body",children:[A(J,{size:"lg",overlay:!0,show:a.loading,loadingConfig:p},"info"),!c.forceSilenceInsideError&&a.error&&l!==!1?A(H,{level:"danger",showCloseButton:!0,onClose:a.clearMessage,children:a.msg}):null,(Array.isArray(r)?~r.indexOf("body"):n)?i("body",n||"",e):null]})]})})},o.prototype.render=function(){var e=this.props,t=e.className,a=e.store;e.body,e.bodyClassName;var n=e.render,s=e.aside,i=e.asideClassName,d=e.classnames;e.showErrorMsg;var l=e.initApi,r=e.regions,p=e.style,u=e.data,c=e.asideResizor,f=e.asideSticky,v=e.pullRefresh,m=e.mobileUI,k=e.translate;e.loadingConfig;var C=e.id,N=e.wrapperCustomStyle,w=e.env,b=e.themeCss,W=e.asidePosition,B={onAction:this.handleAction,onQuery:l?this.handleQuery:void 0,onChange:this.handleChange,onBulkChange:this.handleBulkChange,pageLoading:a.loading},x=Array.isArray(r)?~r.indexOf("aside"):s&&(!Array.isArray(s)||s.length),j=X(p,u),z=this.renderContent(B);return S("div",{className:d("Page",x?"Page--withSidebar":"",x&&f?"Page--asideSticky":"",x&&W?"Page--".concat(W,"Aside"):"",t,D(h({name:"baseControlClassName",id:C,themeCss:b},this.props)),D(h({name:"wrapperCustomStyle",id:C,themeCss:N},this.props))),onClick:this.handleClick,style:j,children:[x?S("div",{className:d("Page-aside",c?"relative":"Page-aside--withWidth",i,D(h(h({},this.props),{name:"asideControlClassName",id:C,themeCss:b}))),children:[n("aside",s||"",h(h({},B),typeof s=="string"?{inline:!1,className:"Page-asideTplWrapper"}:null)),c?A("div",{onMouseDown:this.handleResizeMouseDown,className:d("Page-asideResizor")}):null]}):null,m&&v&&!v.disabled?A($,{...h({},v,{translate:k,onRefresh:this.handleRefresh}),children:z}):z,n("dialog",h(h({},a.action&&a.action.dialog),{type:"dialog"}),{key:"dialog",data:a.dialogData,onConfirm:this.handleDialogConfirm,onClose:this.handleDialogClose,show:a.dialogOpen,onAction:this.handleAction,onQuery:l?this.handleQuery:void 0}),n("drawer",h(h({},a.action&&a.action.drawer),{type:"drawer"}),{key:"drawer",data:a.drawerData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,show:a.drawerOpen,onAction:this.handleAction,onQuery:l?this.handleQuery:void 0}),A(G,{...h({},this.props,{config:{wrapperCustomStyle:N,id:C,themeCss:b,classNames:[{key:"baseControlClassName",weights:{default:{important:!0},hover:{important:!0},active:{important:!0}}},{key:"bodyControlClassName"},{key:"headerControlClassName"},{key:"titleControlClassName"},{key:"toolbarControlClassName"},{key:"asideControlClassName"}]},env:w})})]})},o.defaultProps={asideClassName:"",bodyClassName:"",headerClassName:"",initFetch:!0,toolbarClassName:"",messages:{},asideSticky:!0,asidePosition:"left",pullRefresh:{disabled:!0}},o.propsList=["title","subTitle","initApi","initFetchOn","initFetch","headerClassName","bodyClassName","asideClassName","toolbarClassName","toolbar","body","aside","messages","style","showErrorMsg"],P([O,y("design:type",Function),y("design:paramtypes",[Object]),y("design:returntype",void 0)],o.prototype,"handleResizeMouseDown",null),P([O,y("design:type",Function),y("design:paramtypes",[MouseEvent]),y("design:returntype",void 0)],o.prototype,"handleResizeMouseMove",null),P([O,y("design:type",Function),y("design:paramtypes",[]),y("design:returntype",void 0)],o.prototype,"handleResizeMouseUp",null),P([O,y("design:type",Function),y("design:paramtypes",[]),y("design:returntype",Promise)],o.prototype,"handleRefresh",null),o}(K.Component),ie=function(g){F(o,g);function o(e,t){var a=g.call(this,e)||this,n=t;return n.registerComponent(a),a}return o.prototype.componentWillUnmount=function(){var e=this.context;e.unRegisterComponent(this),g.prototype.componentWillUnmount.call(this)},o.prototype.reloadTarget=function(e,t){var a=this.context;a.reload(e,t)},o.prototype.handleAction=function(e,t,a,n,s){return n===void 0&&(n=!1),M(this,void 0,void 0,function(){var i,d;return R(this,function(l){switch(l.label){case 0:return i=s||this.context,t.actionType!=="reload"?[3,1]:(t.target&&i.reload(t.target,a),[3,4]);case 1:return t.target?(t.target.split(",").forEach(function(r){var p=i.getComponentByName(r);p&&p.doAction&&p.doAction(h(h({},t),{target:void 0}),a)}),[3,4]):[3,2];case 2:return[4,g.prototype.handleAction.call(this,e,t,a,n,s)];case 3:return d=l.sent(),t.reload&&~["url","link","jump"].indexOf(t.actionType)&&i.reload(t.reload,a),[2,d];case 4:return[2]}})})},o.prototype.handleDialogConfirm=function(e,t){for(var a,n,s=[],i=2;i<arguments.length;i++)s[i-2]=arguments[i];var d=this.props.store,l=d.action,r=(a=t.reload)!==null&&a!==void 0?a:l.reload,p=d.getDialogScoped()||this.context;g.prototype.handleDialogConfirm.apply(this,E([e,t],_(s),!1)),r?p.reload(r,d.data):(p==null?void 0:p.component)!==this&&(!((n=p.component)===null||n===void 0)&&n.reload)?p.component.reload():this.context.getComponents().filter(function(u){return u.props.type==="crud"}).forEach(function(u){return u.reload&&u.reload()})},o.prototype.handleDrawerConfirm=function(e,t){var a=this,n,s=this.props.store,i=s.action,d=(n=t.reload)!==null&&n!==void 0?n:i.reload,l=s.getDrawerScoped()||this.context;g.prototype.handleDrawerConfirm.call(this,e,t),setTimeout(function(){var r;d?l.reload(d,s.data):l.component!==a&&(!((r=l==null?void 0:l.component)===null||r===void 0)&&r.reload)?l.component.reload():a.context.getComponents().filter(function(p){return p.props.type==="crud"}).forEach(function(p){return p.reload&&p.reload()})},300)},o.prototype.setData=function(e,t){return this.props.store.updateData(e,void 0,t)},o.prototype.getData=function(){var e=this.props.store;return e.data},o.contextType=Y,o}(se),oe=function(g){F(o,g);function o(){return g!==null&&g.apply(this,arguments)||this}return o=P([Z({type:"page",storeType:q.name,isolateScope:!0})],o),o}(ie);export{oe as PageRenderer,ie as PageRendererBase,se as default};

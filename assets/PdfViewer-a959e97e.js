import{R as F,_ as P,a as x,u as S,r as v,aq as m,h as w,k as _,l as b,j as d,e as c,p as u,q as i,s as j,f as E,e6 as R,ci as V}from"./index-12050af9.js";var k=F.lazy(function(){return P(()=>import("./PdfViewer-28b0d5ce.js"),["assets/PdfViewer-28b0d5ce.js","assets/index-12050af9.js","assets/index-3250bc9b.css"])}),C=function(f){x(t,f);function t(e){var n=f.call(this,e)||this;return n.wrapper=F.createRef(),n.state={inited:!1,loading:!1,error:!1},n}return t.prototype.componentDidMount=function(){this.wrapper.current&&this.setState({width:this.wrapper.current.clientWidth-100}),this.renderPdf()},t.prototype.componentDidUpdate=function(e){var n=this,r=this.props;(S(e.src,r.src,e.data,r.data)||v(r.src,r.data,"| raw")!==v(e.src,e.data,"| raw"))&&(this.abortLoad(),setTimeout(function(){n.fetchPdf()},0)),m(r.data,r.name)&&m(e.data,e.name)!==m(r.data,r.name)&&(this.abortLoad(),this.renderPdf())},t.prototype.componentWillUnmount=function(){this.abortLoad()},t.prototype.abortLoad=function(){this.fetchCancel&&(this.fetchCancel("load canceled"),this.fetchCancel=void 0),this.reader&&(this.reader.abort(),this.reader=void 0)},t.prototype.renderPdf=function(){return w(this,void 0,void 0,function(){var e,n,r,s;return _(this,function(a){switch(a.label){case 0:return e=this.props,n=e.src,r=e.name,s=e.data,this.setState({error:!1}),n?this.file?[3,2]:[4,this.fetchPdf()]:[3,3];case 1:a.sent(),a.label=2;case 2:return[3,5];case 3:return m(s,r)?[4,this.renderFormFile()]:[3,5];case 4:a.sent(),a.label=5;case 5:return[2]}})})},t.prototype.fetchPdf=function(){return w(this,void 0,void 0,function(){var e,n,r,s,a,o,l,h,y=this;return _(this,function(p){switch(p.label){case 0:if(e=this.props,n=e.env,r=e.src,s=e.data,e.translate,r&&(o=v(r,s,"| raw"),typeof o=="string"?a=o:typeof o=="object"&&typeof o.value=="string"&&(a=o.value)),!a)return console.warn("file src is empty"),[2];this.setState({inited:!0,loading:!0,error:!1}),p.label=1;case 1:return p.trys.push([1,3,4,5]),[4,n.fetcher(a,s,{responseType:"arraybuffer",cancelExecutor:function(g){return y.fetchCancel=g}})];case 2:return l=p.sent(),this.file=l.data,this.forceUpdate(),[3,5];case 3:return h=p.sent(),this.setState({error:!0}),console.error(h),[3,5];case 4:return this.setState({loading:!1}),[7];case 5:return[2]}})})},t.prototype.renderFormFile=function(){return w(this,void 0,void 0,function(){var e,n,r,s,a,o=this;return _(this,function(l){return e=this.props,n=e.name,r=e.data,s=m(r,n),this.setState({inited:!0,loading:!0}),s instanceof File&&(a=new FileReader,a.onload=function(h){var y=a.result;o.file=y,o.setState({loading:!1}),o.forceUpdate()},a.onerror=function(h){o.setState({error:!0})},a.readAsArrayBuffer(s),this.reader=a),[2]})})},t.prototype.renderEmpty=function(){var e=this.props,n=e.src,r=e.name;return!n&&!r?b("svg",{width:"100%",height:"100",xmlns:"http://www.w3.org/2000/svg",children:[d("rect",{x:"0",y:"0",width:"100%",height:"100",style:{fill:"#F7F7F9"}}),d("text",{x:"50%",y:"50%",fontSize:"18",textAnchor:"middle",alignmentBaseline:"middle",fontFamily:"monospace, sans-serif",fill:"#555555",children:"PDF viewer"})]}):null},t.prototype.renderError=function(){var e=this.props,n=e.src,r=e.translate,s=this.state.error;return s&&n?d("div",{children:r("loadingFailed")+" url:"+n}):null},t.prototype.renderTip=function(){return d("div",{children:d("p",{children:"[PdfViewer]: pdfjsWorkerSrc is required, Please set the `pdfjsWorkerSrc` in setGlobalOptions function."})})},t.prototype.render=function(){var e=this.props,n=e.className,r=e.classnames;e.translate;var s=e.height,a=e.background,o=R().pdfjsWorkerSrc,l=this.state,h=l.loading,y=l.inited,p=l.error,g=Math.max(this.props.width||this.state.width,300);return b("div",{ref:this.wrapper,children:[this.renderEmpty(),o?d(V.Suspense,{fallback:d("div",{children:"..."}),children:y&&!p?d(k,{file:this.file,loading:h,className:n,classnames:r,width:g,height:s,background:a}):null}):this.renderTip(),this.renderError()]})},c([u,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],t.prototype,"abortLoad",null),c([u,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],t.prototype,"renderPdf",null),c([u,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],t.prototype,"fetchPdf",null),c([u,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],t.prototype,"renderFormFile",null),c([u,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],t.prototype,"renderEmpty",null),c([u,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],t.prototype,"renderError",null),c([u,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],t.prototype,"renderTip",null),t}(F.Component),W=function(f){x(t,f);function t(e,n){var r=f.call(this,e)||this,s=n;return s.registerComponent(r),r}return t.prototype.componentWillUnmount=function(){var e;(e=f.prototype.componentWillUnmount)===null||e===void 0||e.call(this);var n=this.context;n.unRegisterComponent(this)},t.contextType=j,t=c([E({type:"pdf-viewer"}),i("design:paramtypes",[Object,Object])],t),t}(C);export{k as PdfView,W as PdfViewerRenderer,C as default};

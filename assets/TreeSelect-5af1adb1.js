import{a as X,R as j,a6 as xe,b2 as M,w as b,ae as $,Y as N,aq as Pe,d as m,b4 as q,h as B,k,bj as Se,bL as Re,br as z,E as I,bX as De,j as O,bV as Le,bz as W,U as je,l as Q,F as Ne,bg as Be,S as ke,P as Ke,Q as Ue,bh as He,V as Me,e as v,p as f,q as s,a_ as $e,b9 as qe}from"./index-12050af9.js";var ze=function(F){X(o,F);function o(e){var t=F.call(this,e)||this;return t.container=j.createRef(),t.input=j.createRef(),t.cache={},t.targetRef=function(n){return t.target=n?xe.findDOMNode(n):null},t.sourceLoaded=!1,t.state={inputValue:"",tempValue:"",isOpened:!1},t.open=t.open.bind(t),t.close=t.close.bind(t),t.handleChange=t.handleChange.bind(t),t.handleTempChange=t.handleTempChange.bind(t),t.handleConfirm=t.handleConfirm.bind(t),t.clearValue=t.clearValue.bind(t),t.handleFocus=t.handleFocus.bind(t),t.handleBlur=t.handleBlur.bind(t),t.handleKeyPress=t.handleKeyPress.bind(t),t.handleInputChange=M(t.handleInputChange.bind(t),150,{trailing:!0,leading:!1}),t.handleInputKeyDown=t.handleInputKeyDown.bind(t),t.loadRemote=M(t.loadRemote.bind(t),250,{trailing:!0,leading:!1}),t}return o.prototype.componentDidMount=function(){this.loadRemote("")},o.prototype.componentWillUnmount=function(){this.sourceLoaded=!1},o.prototype.open=function(e){this.props.disabled||this.setState({isOpened:!0},e)},o.prototype.close=function(){var e=this;this.setState({isOpened:!1,inputValue:this.props.multiple?this.state.inputValue:""},function(){return e.loadRemote(e.state.inputValue)})},o.prototype.resolveOptions=function(){var e=this.props,t=e.options,n=e.searchable,i=e.autoComplete;return!b(i)&&n&&this.state.inputValue?this.filterOptions(t,this.state.inputValue):t},o.prototype.resolveOption=function(e,t){var n=this;return $(e,function(i){var a=n.props.valueField||"value",r=z(i,a)?i[a]:"";return r===t})},o.prototype.handleFocus=function(e){var t=this.props,n=t.dispatchEvent,i=t.value,a=this.resolveOptions(),r=this.resolveOption(a,i);n("focus",N(this.props,{value:i,item:r,items:a}))},o.prototype.handleBlur=function(e){var t=this.props,n=t.dispatchEvent,i=t.value,a=this.resolveOptions(),r=this.resolveOption(a,i);n("blur",N(this.props,{value:i,item:r,items:a}))},o.prototype.handleKeyPress=function(e){e.key===" "&&e.shiftKey&&(this.handleOutClick(e),e.preventDefault())},o.prototype.validate=function(){var e=this.props,t=e.value,n=e.minLength,i=e.maxLength,a=e.delimiter,r=Array.isArray(t)?t:(t?String(t):"").split(a||",");if(n&&r.length<n)return"已选择数量低于设定的最小个数".concat(n,"，请选择更多的选项。");if(i&&r.length>i)return"已选择数量超出设定的最大个数".concat(i,"，请取消选择超出的选项。")},o.prototype.removeItem=function(e,t){var n=this.props,i=n.selectedOptions,a=n.joinValues,r=n.extractValue,l=n.delimiter,d=n.valueField,u=n.onChange,p=n.disabled;if(t&&t.stopPropagation(),!p){var h=i.concat();h.splice(e,1);var c=h;a?c=h.map(function(g){return g[d||"value"]}).join(l||","):r&&(c=h.map(function(g){return g[d||"value"]})),u(c)}},o.prototype.handleChange=function(e){var t=this,n=this.props.multiple;n||this.close(),this.setState({inputValue:""},function(){return t.resultChangeEvent(e)})},o.prototype.handleTempChange=function(e){this.setState({tempValue:e})},o.prototype.handleConfirm=function(){var e=this;this.close(),this.setState({inputValue:""},function(){return e.resultChangeEvent(e.state.tempValue)})},o.prototype.handleInputChange=function(e){var t=this,n=this.props,i=n.autoComplete,a=n.data;this.setState({inputValue:e},b(i,a)?function(){return t.loadRemote(t.state.inputValue)}:void 0)},o.prototype.handleInputKeyDown=function(e){var t=this.state.inputValue,n=this.props,i=n.multiple,a=n.selectedOptions;e.key==="Backspace"&&!t&&a.length&&i&&this.removeItem(a.length-1)},o.prototype.resetValue=function(){var e,t,n=this.props,i=n.onChange,a=n.resetValue,r=n.formStore,l=n.store,d=n.name,u=(t=Pe((e=r==null?void 0:r.pristine)!==null&&e!==void 0?e:l==null?void 0:l.pristine,d))!==null&&t!==void 0?t:a;i(u)},o.prototype.clearValue=function(){var e=this.props,t=e.onChange,n=e.resetValue;t(typeof n>"u"?"":n)},o.prototype.filterOptions=function(e,t){var n=this,i=this.props,a=i.labelField,r=i.valueField;return e.map(function(l){if(l=m({},l),l.visible=!!q([l],t,{keys:[a||"label",r||"value"],threshold:q.rankings.CONTAINS}).length,!l.visible&&l.children){l.children=n.filterOptions(l.children,t);var d=l.children.filter(function(u){return u.visible}).length;l.visible=!!d}return l.visible&&(l.collapsed=!1),l})},o.prototype.loadRemote=function(e){return B(this,void 0,void 0,function(){var t,n,i,a,r,l,d,p,h,u,p,h;return k(this,function(c){switch(c.label){case 0:if(t=this.props,n=t.autoComplete,i=t.env,a=t.data,r=t.setOptions,l=t.setLoading,d=t.source,!b(n,a)||!e&&b(d)&&!this.sourceLoaded)return this.sourceLoaded=!0,[2];if(!i||!i.fetcher)throw new Error("fetcher is required");if(this.cache[e]||~e.indexOf("'"))return p=this.cache[e]||[],h=this.mergeOptions(p),r(h),[2,Promise.resolve({options:h})];l(!0),c.label=1;case 1:return c.trys.push([1,,3,4]),[4,i.fetcher(n,m(m({},a),{term:e,value:e}))];case 2:return u=c.sent(),p=u.data&&u.data.options||u.data||[],this.cache[e]=p,h=this.mergeOptions(p),r(h),[2,{options:h}];case 3:return l(!1),[7];case 4:return[2]}})})},o.prototype.mergeOptions=function(e){var t=this.props.selectedOptions,n=Se(e).concat();return Array.isArray(t)&&t.length&&t.forEach(function(i){$(n,function(a){return a.value==i.value})||n.push(m({},i))}),n},o.prototype.reload=function(){var e=this.props.reloadOptions;e&&e()},o.prototype.handleOutClick=function(e){e.defaultPrevented||this.setState({isOpened:!0})},o.prototype.handleResultChange=function(e){var t=this.props,n=t.joinValues,i=t.extractValue,a=t.delimiter,r=t.valueField,l=t.multiple,d=Array.isArray(e)?e.concat():[];if(!l&&!d.length){this.resultChangeEvent("");return}(n||i)&&(d=e.map(function(u){return u[r||"value"]})),n&&(d=d.join(a||",")),this.resultChangeEvent(d)},o.prototype.doAction=function(e,t,n){var i,a,r,l,d;e.actionType==="clear"?this.clearValue():e.actionType==="reset"?this.resetValue():e.actionType==="add"?this.addItemFromAction((i=e.args)===null||i===void 0?void 0:i.item,(a=e.args)===null||a===void 0?void 0:a.parentValue):e.actionType==="edit"?this.editItemFromAction((r=e.args)===null||r===void 0?void 0:r.item,(l=e.args)===null||l===void 0?void 0:l.originValue):e.actionType==="delete"?this.deleteItemFromAction((d=e.args)===null||d===void 0?void 0:d.value):e.actionType==="reload"&&this.reload()},o.prototype.addItemFromAction=function(e,t){var n=this.props,i=n.onAdd,a=n.options,r=n.valueField,l=Re(a,function(d){var u=r||"value",p=z(d,u)?d[u]:"";return p===t})||[];i&&i(l.concat(0),e,!0)},o.prototype.editItemFromAction=function(e,t){var n=this.props,i=n.onEdit,a=n.options,r=this.resolveOption(a,t);i&&r&&i(m(m({},e),{originValue:t}),r,!0)},o.prototype.deleteItemFromAction=function(e){var t=this.props,n=t.onDelete,i=t.options,a=this.resolveOption(i,e);n&&a&&n(a)},o.prototype.resultChangeEvent=function(e){return B(this,void 0,void 0,function(){var t,n,i,a,r,l;return k(this,function(d){switch(d.label){case 0:return t=this.props,n=t.onChange,i=t.dispatchEvent,a=this.resolveOptions(),r=this.resolveOption(a,e),[4,i("change",N(this.props,{value:e,item:r,items:this.resolveOptions()}))];case 1:return l=d.sent(),l!=null&&l.prevented?[2]:(n&&n(e),[2])}})})},o.prototype.handleNodeClick=function(e){return B(this,void 0,void 0,function(){var t,n,i,a;return k(this,function(r){switch(r.label){case 0:return t=this.props,n=t.dispatchEvent,i=t.data,[4,n("itemClick",I(i,{item:e}))];case 1:return a=r.sent(),a!=null&&a.prevented?[2]:[2]}})})},o.prototype.renderOptionItem=function(e,t){var n=this.props,i=n.menuTpl,a=n.render,r=n.data;return a("option/".concat(t.index),i,{data:I(I(r,m({},t)),e)})},o.prototype.renderItem=function(e){var t=this.props,n=t.labelField,i=t.options,a=t.hideNodePathLabel;if(a)return e[n||"label"];var r=De(i,e,!0);return"".concat(r?r.map(function(l){return"".concat(l[n||"label"])}).join(" / "):e[n||"label"])},o.prototype.domRef=function(e){this.treeRef=e},o.prototype.renderOuter=function(){var e=this.props,t=e.value,n=e.enableNodePath,i=e.pathSeparator,a=i===void 0?"/":i,r=e.disabled,l=e.joinValues,d=e.extractValue,u=e.delimiter;e.placeholder;var p=e.options,h=e.multiple,c=e.valueField,g=e.initiallyOpen,V=e.unfoldedLevel,_=e.withChildren,C=e.rootLabel,w=e.cascade,x=e.rootValue,P=e.showIcon,T=e.showRadio;e.popOverContainer;var S=e.onlyChildren,y=e.onlyLeaf,R=e.classPrefix,D=e.optionsPlaceholder,L=e.searchable,A=e.autoComplete,E=e.maxLength,Y=e.minLength,G=e.labelField,J=e.deferField,Z=e.nodePath,ee=e.onAdd,te=e.creatable,ne=e.createTip,ie=e.addControls,ae=e.onEdit,oe=e.editable,re=e.editTip,le=e.editControls,se=e.removable,de=e.removeTip,ue=e.onDelete,pe=e.rootCreatable,he=e.rootCreateTip,K=e.translate,ce=e.deferLoad,ve=e.expandTreeOptions,me=e.selfDisabledAffectChildren,fe=e.showOutline,ge=e.autoCheckChildren,ye=e.autoCancelParent,Ce=e.hideRoot,be=e.virtualThreshold,U=e.itemHeight,Oe=e.menuTpl,Fe=e.enableDefaultIcon,H=e.mobileUI,Ve=e.testIdBuilder,Te=e.nodeBehavior,Ie=e.itemActions,_e=e.classnames,Ae=e.id,Ee=e.themeCss,we=!b(A)&&L&&this.state.inputValue?this.filterOptions(p,this.state.inputValue):p;return O(Le,{classPrefix:R,onRef:this.domRef,onlyChildren:S,onHandleNodeClick:this.handleNodeClick,onlyLeaf:y,labelField:G,valueField:c,deferField:J,disabled:r,onChange:H?this.handleTempChange:this.handleChange,joinValues:l,extractValue:d,delimiter:u,placeholder:K(D),options:we,highlightTxt:this.state.inputValue,multiple:h,initiallyOpen:g,unfoldedLevel:V,withChildren:_,autoCheckChildren:ge,autoCancelParent:ye,rootLabel:K(C),rootValue:x,showIcon:P,showRadio:T,showOutline:fe,cascade:w,foldedField:"collapsed",hideRoot:Ce,value:t||"",nodePath:Z,enableNodePath:n,pathSeparator:a,maxLength:E,minLength:Y,onAdd:ee,creatable:te,createTip:ne,rootCreatable:pe,rootCreateTip:he,onEdit:ae,editable:oe,editTip:re,removable:se,removeTip:de,onDelete:ue,bultinCUD:!ie&&!le,onDeferLoad:ce,onExpandTree:ve,selfDisabledAffectChildren:me,virtualThreshold:be,itemHeight:W(U)>0?W(U):void 0,itemRender:Oe?this.renderOptionItem:void 0,enableDefaultIcon:Fe,mobileUI:H,nodeBehavior:Te,itemActionsRender:Ie?this.renderItemActions:void 0,actionClassName:_e(je(m(m({},this.props),{name:"actionControlClassName",id:Ae,themeCss:Ee}))),testIdBuilder:Ve})},o.prototype.renderItemActions=function(e,t){var n=this.props,i=n.itemActions,a=n.data,r=n.render;return r("action/".concat(t.index),i||"",{data:I(I(a,m({},t)),e)})},o.prototype.render=function(){var e=this,t=this.props,n=t.className;t.style;var i=t.disabled,a=t.inline,r=t.loading,l=t.multiple;t.value;var d=t.clearable,u=t.classPrefix,p=t.classnames,h=t.searchable,c=t.autoComplete,g=t.selectedOptions,V=t.placeholder,_=t.popOverContainer,C=t.mobileUI,w=t.maxTagCount,x=t.overflowTagPopover,P=t.translate,T=t.env,S=t.loadingConfig,y=t.testIdBuilder,R=t.wrapperCustomStyle,D=t.id,L=t.themeCss,A=this.state.isOpened,E=l?g:g.length?this.renderItem(g[0]):"";return Q(Ne,{children:[Q("div",{...m({ref:this.container,className:p("TreeSelectControl",n)},y==null?void 0:y.getTestId()),children:[O(Be,{popOverContainer:_||T.getModalContainer,maxTagCount:w,overflowTagPopover:x,disabled:i,ref:this.targetRef,placeholder:P(V??"placeholder.empty"),inputPlaceholder:"",className:p("TreeSelect",{"TreeSelect--inline":a,"TreeSelect--single":!l,"TreeSelect--multi":l,"TreeSelect--searchable":h||b(c),"is-opened":this.state.isOpened,"is-disabled":i}),result:E,onResultClick:this.handleOutClick,value:this.state.inputValue,onChange:this.handleInputChange,onResultChange:this.handleResultChange,itemRender:this.renderItem,onKeyPress:this.handleKeyPress,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeyDown:this.handleInputKeyDown,clearable:d,allowInput:!C&&(h||b(c))&&(l||!E),hasDropDownArrow:!0,readOnly:C,mobileUI:C,testIdBuilder:y==null?void 0:y.getChild("result-box"),children:r?O(ke,{loadingConfig:S,size:"sm"}):void 0}),!C&&A?O(Ke,{container:_||function(){return e.container.current},target:function(){return e.target},show:!0,children:O(Ue,{classPrefix:u,className:"".concat(u,"TreeSelect-popover"),style:{minWidth:this.target?this.target.offsetWidth:void 0},onHide:this.close,overlay:!0,children:this.renderOuter()})}):null,C?O(He,{container:T.getModalContainer,className:p("".concat(u,"TreeSelect-popup")),isShow:A,onHide:this.close,showConfirm:!0,onConfirm:this.handleConfirm,children:this.renderOuter()}):null]}),O(Me,{...m({},this.props,{config:{wrapperCustomStyle:R,id:D,themeCss:L,classNames:[{key:"actionControlClassName"}]},env:T})})]})},o.defaultProps={hideRoot:!0,placeholder:"Select.placeholder",optionsPlaceholder:"placeholder.noData",multiple:!1,clearable:!0,rootLabel:"Tree.root",rootValue:"",showIcon:!0,joinValues:!0,extractValue:!1,delimiter:",",resetValue:"",hideNodePathLabel:!1,enableNodePath:!1,pathSeparator:"/",selfDisabledAffectChildren:!0},v([f,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],o.prototype,"handleOutClick",null),v([f,s("design:type",Function),s("design:paramtypes",[Array]),s("design:returntype",void 0)],o.prototype,"handleResultChange",null),v([f,s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],o.prototype,"addItemFromAction",null),v([f,s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],o.prototype,"editItemFromAction",null),v([f,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],o.prototype,"deleteItemFromAction",null),v([f,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],o.prototype,"resultChangeEvent",null),v([f,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],o.prototype,"handleNodeClick",null),v([f,s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],o.prototype,"renderOptionItem",null),v([f,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],o.prototype,"renderItem",null),v([f,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],o.prototype,"domRef",null),v([f,s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],o.prototype,"renderItemActions",null),v([$e(),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",void 0)],o.prototype,"render",null),o}(j.Component),Qe=function(F){X(o,F);function o(){return F!==null&&F.apply(this,arguments)||this}return o=v([qe({type:"tree-select"})],o),o}(ze);export{Qe as TreeSelectControlRenderer,ze as default};
